

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <!--<meta http-equiv="X-UA-Compatible" content="IE=9; IE=8" />-->
        <meta name="robots" content="index,follow" />
<meta name="description" content="CPR Windbg CDB perfmon netmon kd" />
<meta name="keywords" content="cpr critical problem resolution advanced debugging windows hangs leaks microsoft windows cpu spins blue screen of death BSOD STOP GES ronsto craiga" />
<meta name="GENERATOR" content="Telligent Community 5.6.583.17018 (Build: 5.6.583.17018)" />
<link rel="pingback" href="http://blogs.msdn.com/b/ntdebugging/pingback.aspx" />
<link rel="alternate" type="application/rss+xml" title="Site Home (RSS 2.0)" href="http://blogs.msdn.com/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="ntdebug&#39;s Comments (RSS 2.0)" href="/members/ntdebug/comments/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="ntdebug&#39;s Activities (RSS 2.0)" href="/members/ntdebug/activities/rss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Activities of People ntdebug Follows (RSS 2.0)" href="/members/ntdebug/activities/followersrss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="ntdebug&#39;s Groups Activities (RSS 2.0)" href="/members/ntdebug/activities/groupsrss.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Ntdebugging Blog (RSS 2.0)" href="http://blogs.msdn.com/b/ntdebugging/rss.aspx"  />
<link rel="alternate" type="application/atom+xml" title="Ntdebugging Blog (Atom 1.0)" href="http://blogs.msdn.com/b/ntdebugging/atom.aspx"  />
<link rel="alternate" type="application/rss+xml" title="Ntdebugging Blog - All Comments (RSS 2.0)" href="http://blogs.msdn.com/b/ntdebugging/rsscomments.aspx"  />
<link rel="alternate" type="application/rss+xml" title="x64 Manual Stack Reconstruction and Stack Walking - Comments for this post (RSS 2.0)" href="http://blogs.msdn.com/b/ntdebugging/rsscomments.aspx?WeblogPostID=10011295"  />

            <link rel="stylesheet" href="/themes/generic/css/layout.css" type="text/css" media="screen" />
        
          <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
          <link rel="shortcut icon" type="image/ico" href="/themes/wireframe/favicon.ico" />
          <link type="text/css" rel="stylesheet" href="/themes/wireframe/css/screen.css" media="screen,print" />
        
          <link type="text/css" rel="stylesheet" href="/themes/blogs/wireframe/css/wireframe.css" media="screen,print" />		
          <link type="text/css" rel="stylesheet" href="/themes/wireframe/css/DynamicStyle.aspx?PreviewKey=0" media="screen,print" />
          <link type="text/css" rel="stylesheet" href="/themes/blogs/wireframe/css/DynamicStyle.aspx?WeblogID=7700&PreviewKey=0" media="screen,print" />
        
          <!--[if lte IE 6]>
              <link type="text/css" rel="stylesheet" href="/themes/wireframe/css/ie6.css" media="screen,print" />
          <![endif]-->
          <link type="text/css" rel="stylesheet" href="/themes/wireframe/css/print.css" media="print" />
        <meta name="msvalidate.01" content="B717AD6FC29D3A844832AF011B5F9E4C" />
<meta name="WT.sp" content="_ntdebugging_">
<meta name="WT.sp_cluster" content="_Platforms_"> <meta name="WT.sp_group" content="_cts_">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blogs.msdn.com/b/ntdebugging/rsd.ashx" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" title="WLWManifest" href="http://blogs.msdn.com/b/ntdebugging/wlwmanifest.ashx" />
<title>
	x64 Manual Stack Reconstruction and Stack Walking - Ntdebugging Blog - Site Home - MSDN Blogs
</title></head>
	<body spellcheck="true">
		<form name="aspnetForm" method="post" action="/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx" onsubmit="javascript:return WebForm_OnSubmit();" id="aspnetForm">
<div>
<input type="hidden" name="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_answer" id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_answer" value="" />
<input type="hidden" name="__EVENTTARGET" id="__EVENTTARGET" value="" />
<input type="hidden" name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" />
<input type="hidden" name="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_encrypted" id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_encrypted" value="0xqu0M65ZESwm6mfSL3t0oz9qCgEuZqLFqx0mm2oAYc=" />
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKMTM5OTAxNDYyNWRkvI787cXLvh9XHlDReEjVejxzcZ4=" />
</div>

<script type="text/javascript">
//<![CDATA[
var theForm = document.forms['aspnetForm'];
if (!theForm) {
    theForm = document.aspnetForm;
}
function __doPostBack(eventTarget, eventArgument) {
    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {
        theForm.__EVENTTARGET.value = eventTarget;
        theForm.__EVENTARGUMENT.value = eventArgument;
        theForm.submit();
    }
}
//]]>
</script>


<script src="/WebResource.axd?d=Z2cQcTXWgTIacDQe5RRNWmFyimLHJt8vzSXe1uPSng4eqr0myJHiayeAq1crklEPpVKsHC4W0kCtInsSLWolE5Uo5p41&amp;t=634218895411170923" type="text/javascript"></script>


<script src="/WebResource.axd?d=SOm_d8KPCvLZqYHrhruKr9DdER9uVeTCF1FNDrQsmkkW6AGoFUpVPsp_sTVI0yBnuCqmAGaw9mn1GN6KHTm-O-scKjBDPWhJUPaoE5GX-W_PceNeDrCYaZsBFYwMz8SJcVcGWXF1earb2kCelpGh_yHCFNurOjx3n2A7T22-FJOIrny2temFXRG8ehi8UGCKQTTzSM4cj0CEdSfmhseuKk27Fmk1&amp;t=634462368096248087" type="text/javascript"></script>
<script src="/WebResource.axd?d=X_bemaoIL4hjGUz9ZLneLqw-9c9VLtsWZNcpFAvJZjyKqy0p35kk2J5MVTgZ0_e7dzVplzG4gPuhYGCSEZ9_2V48ALIbJSP67YqRe_uBJ_EZoaemm2d7CXOUW-nZ8_pxnmZG0zD-4rwjao05LtAkIZm3fBDpXoPLWyORtmFV3KS69tTk0&amp;t=634462368120894981" type="text/javascript"></script>
<script src="/WebResource.axd?d=3GU3tjSEW1ECXKvAUZHsxDFAslEZgbJjoLfCXBVUTswP5j5YYgW1hzjXqjzKD2dwNn0_t62E4VjYXqkzlUOlcdFK8Z_Brbo2xSEHJwdXoWqZ2JKysmKSDqwNmwzMbkFAkkWixyHGSjXGuv05u78Pi5NT0vd1V1i0XAu44rGfRSX4FePt0&amp;t=634462368120894981" type="text/javascript"></script>
<script src="/WebResource.axd?d=ZNAKjLeYJhqT_oJ98OwZwVJzbm3UJOEc5LdYje7ix7F87IHOHrdtwh0VGbHW1w50Wi1G774JMTJOjcODrws7U3QA83DLFF0NxSeh0X7TA1drh1FHRbbpemnlRUet9k4QWDfNyUfoZvWBZm4x8hX6igDXjctw10e4qulgpzBxItVQN2eu0&amp;t=634462368096248087" type="text/javascript"></script><script type="text/javascript" src="/utility/jquery/jquery-1.5.2.min.js"></script>
<script src="/WebResource.axd?d=6FRFqSBfWW_ZCmFE0BqdIlvcr4zxqdiaWN8vp2XHPAhpG0AD0_NxkFQ1CcKGC40FJPxdj4F8A7tYf9Z_yaF3WsmUxjEtOVMNJXB8Kwa3_EVNAC48gN_yerZiw_aK8Oz17MWCcfozfjgs_8aIixBDL-2IeZQx3Xlbop7fBCJv5wwZ9pQJ0&amp;t=634462368120894981" type="text/javascript"></script>
<script src="/WebResource.axd?d=-I9opVMlYERsOWADr5Ja4RssDj9bjzJHgxNjPQ9OjvoFh9msYez2FDTy088QYu1C72c0WsRQFRwLvbjkl5W-5nUXl_DP64ke9Lcb62qn5BUa-Pc2HN1pvm_BxvRFy0R5YH4IK1QyICM_8SECrbjcS3m5T6W1PwtrsEZAgYO-WlfqJYLwakPjAePpK_rDp4hCPrtBXA2&amp;t=634462368120894981" type="text/javascript"></script>
<script src="/WebResource.axd?d=HaOPiNm1e0sLVdYesQz9mxWwGXMPQMB4pwvUsGB8ZJGyRNswfv6H9HTF-JKe-U2Y1vxDijsXcYELa58DHCNpyH_92CgFm0Ufhn79o8ERhzVbFsOVbA3l7FI1LLkkpikqzv90nK2u1s9OJzHVD9CVAFXD88fLNAeJyjBJ4gdZzh9UGdLy0&amp;t=634462368096248087" type="text/javascript"></script><script type="text/javascript" src="/utility/jquery/autoresize.jquery.min.js"></script>
<script src="/WebResource.axd?d=ahlDYNbDLqewiDAWERYywUOtVFS2G5LIDpqT1GeuLSeL9pZ00_hrjGdFvqY_kyCXvYVPgnStzP15cHQkWAzWlCzgdszLOoROgHYM-Q8BV8Z6UyC80&amp;t=634218895411170923" type="text/javascript"></script>
<script src="/WebResource.axd?d=kxj7BEpf5NlDw5wc7ut0Pv8px29_xUzCgrOLbPtW8-bh-LCYGNMq9HKXIglTvHT03YjdsOzDcgCUYb4BvAYLB7xvKXjwAVW45cg2IiRiqOnRu4IiHEtjGR4XUTk9MIpj9rJXW0pty21-xq9AKiCLgWlXTfv2wdtrSq8dEBUpeVtK-4KyLBISa2R357ofdGKEaQOtrA2&amp;t=634462368096248087" type="text/javascript"></script>
<script src="/WebResource.axd?d=5h4uDIKw0jfgLvo3lCMA-4uYbYFLjWH-CYL_-M2qsXt9DrFoEenc0y52xIhQOIuH3vbY259X3nftMHddV3CFRlcHaaTZaWGgUpmuHdITXpKI9rvCcKFLHbyvpaIOj0Z3daJZkb5OxqyK8MexioOup8dp9HMMcUIaOaV45OQR7pBZLMmbWyMtl_nN2Z62vnk7be3DkGA0e424SusmrWa2Gh69sQk1&amp;t=634462368097340038" type="text/javascript"></script>
<script src="/WebResource.axd?d=g8NlLbN_osz0sxxr-Bna0nHqaizsNTSphFqtHKkDWqiKQsKKuaAQOVQypJLBFBqEvJaa9dJ2zwQ2JliJ5HhivoDHWcQuKR5yA8KFCBHClR8-sqBOFF19sdL8EztLKXVazT-I1lAPYxzE8AVMmxl9C1bu8SgYgaRi4JnPS9I7huwwIo9w0&amp;t=634462368120894981" type="text/javascript"></script>
<script src="/WebResource.axd?d=uV5jECGiS8_GGPpJV2cuiPaxOggI_Y2EpUA7ib1PBadUMhq0cmHRiSADtsCT3nmnKrLT5MkAP8h8F3UMJW_2Z3BSuXdlF27_BqU2j91NEX9nvMQ-sYjrkuE32_4xlcSeX4lK-LKMuS9zQ2YdbgN2JBkNqRRQwxIqGO6XxMTzGcqEcljS5LsQy6GnlKQRDlppAf2smw2&amp;t=634462368096248087" type="text/javascript"></script>
<script src="/WebResource.axd?d=6DtyjlTHYsWSfgn8LS123dLXJsjyvfjZ0Oia-72mAUZG1gOZ3jrGqp_gFPDiYWMqrm5wwHYCagmkeYSJJ8aCdv3j2skd6GY_-ZfcrbUegYvAtAuSLp7uYLU4AAZHCIHpZyVriNhxlPfYHlAdweplddfOsLQ1&amp;t=634462368659070831" type="text/javascript"></script>
<script src="/WebResource.axd?d=TjiNY1rmv8W4Kzz4QZNyp2P63E6t793JZRNHHbvHuWrJaqpghfU8youCEpBAslnDhi_lkdjijHgIojxgUIqfM-y1jhUZUA-jM-Afdq2fsvIyNiGpZ-YmVXiUSdcBUkhRxJsxknB8hZRBkMJhhgaW8RIio1ZUVIB-8C07L5RKMfEOZZh00&amp;t=634462368096248087" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
function WebForm_OnSubmit() {
if (typeof(ValidatorOnSubmit) == "function" && ValidatorOnSubmit() == false) return false;
return true;
}
//]]>
</script>

			
            
                
            
            <div class="header-fragments-header"></div>
<div class="header-fragments"><div class="header-fragment-outer top-bar wireframe-header-fragment-outer wireframe-top-bar"><div class="header-fragment-inner top-bar wireframe-header-fragment-inner wireframe-top-bar"><div class="header-fragment welcome-message" id="header-fragment-247403536">


<!-- always render -->
</div><div class="header-fragment login-logout" id="header-fragment-247403537">





        <div class="navigation-list-header"></div>
        <ul class="navigation-list">

            <li class="navigation-item">
                <span id="ctl00_header_fragment_247403537__9be11d_ctl00_ctl02_ctl05_WLIDLoginButton1" class="internal-link live-id-button"><a href="https://login.live.com/login.srf?wa=wsignin1.0&rpsnv=11&ct=1313476320&rver=6.0.5286.0&wp=MBI&wreply=http:%2F%2Fblogs.msdn.com%2Fb%2Fntdebugging%2Farchive%2F2010%2F05%2F12%2Fx64-manual-stack-reconstruction-and-stack-walking.aspx&lc=1033&id=271611">Sign In</a></span>
            </li>
        </ul>
        <div class="navigation-list-footer"></div>
    </div><div class="header-fragment user-welcome-without-login" id="header-fragment-247403538">

 &nbsp;<!-- always render -->

</div></div></div><div class="header-fragment-outer wireframe-header-fragment-outer site-banner"><div class="header-fragment-inner wireframe-header-fragment-inner site-banner"><div class="header-fragment site-banner" id="header-fragment-247403539">


<div class="site-banner-header"></div>
<div class="site-banner">
    
    
    
            <div class="site-logo"><a href="/">
                    <img src="/themes/MSDN2/images/MSDN/logo_msdn.png" alt="" style="border-width:0px;" />
                </a></div>
        
</div>
<div class="site-banner-footer"></div></div></div></div><div class="header-fragment-outer wireframe-header-fragment-outer search"><div class="header-fragment-inner wireframe-header-fragment-inner search"><div class="header-fragment search" id="header-fragment-247403540">

<script src="/Utility/HeaderFragments/Core/Search.js?Version=5.6.583.17018&amp;LastChanged=634462620319630063" type="text/javascript"></script>

<script type="text/javascript">
	// <![CDATA[
	var Core_Search_AjaxEndpoint = '/Utility/HeaderFragments/Core/SearchAjax.asmx'
	var Core_Search_NoSearchResults = 'No results found'

	var ctl00_header_fragment_247403540={"wrapperId":"header-fragment-247403540","variableName":"ctl00_header_fragment_247403540","parameter":{"popupId":"ctl00_header_fragment_247403540__9be11d_ctl00_SearchPopup","textBoxId":"ctl00_header_fragment_247403540__9be11d_ctl00_SearchText","searchResultWrapperHtmlBlock":"{SearchResults}","searchGroupHtmlBlock":"\r\n\t\t<div class=\"content-list-header\"></div>\r\n\t\t<div class=\"content-list-name\">{ContentName}</div>\r\n\t\t<ul class=\"content-list\">\r\n\t\t\t{ContentItems}\r\n\t\t</ul>\r\n\t\t<div class=\"content-list-footer\"></div>\r\n\t\t","searchItemHtmlBlock":"<li class=\"content-item\"><a href=\"{Link}\" class=\"internal-link {LinkType}\"><span></span>{Title}</a></li>\t\t","searchSearchingHtmlBlock":"<div class=\"message loading\">Searching...</div>","searchNoResultsHtmlBlock":"<div class=\"message norecords\">No results found</div>","showAllHtmlBlock":"<a href=\"{ShowAllLink}\" class=\"internal-link search\"><span></span>Show All...</a>","searchErrorHtmlBlock":"<div class=\"message error\">Search is currently unavailable.</div>","searchOptionsPopup":"ctl00_header_fragment_247403540__9be11d_ctl00_SearchOptionsPopup","searchOptionName":"ctl00_header_fragment_247403540__9be11d_ctl00_filter","lastKeyCode":"","timeout":""}};
		
	$(document).ready(function() {
		Core_Search_Register(ctl00_header_fragment_247403540);
	});
	// ]]>
</script>

<div class="field-list-header">
</div>
<fieldset class="field-list">
	<ul class="field-list">
		<li class="field-item"><span class="field-item-input"><input name="ctl00$header_fragment_247403540$_9be11d$ctl00$SearchText" type="text" maxlength="64" size="15" id="ctl00_header_fragment_247403540__9be11d_ctl00_SearchText" class="search empty" /></span></li>
		
	</ul>
</fieldset>
<div class="field-list-footer">
</div>
<div id="ctl00_header_fragment_247403540__9be11d_ctl00_SearchPopup" style="position:absolute;visibility:hidden;left:-5000px;"></div>

</div></div></div><div class="header-fragment-outer wireframe-header-fragment-outer group-navigation"><div class="header-fragment-inner wireframe-header-fragment-inner group-navigation"><div class="header-fragment group-navigation" id="header-fragment-247403541">

<script src="/Utility/HeaderFragments/Core/GroupNavigation.js?Version=5.6.583.17018" type="text/javascript"></script>
    
<div id="ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ParentGroupListContainer" class="parent-container" style="width: 100%">
<div class="parent-sub-container">
	
            <div class="navigation-list-header"></div>
            <ul class="navigation-list parent">
            <li class="navigation-item" style="display: none;">
                <a href="/">MSDN Blogs</a>
            </li>
        
            <li class="navigation-item entry" style="display: none;">
				
						<a class="internal-link view-group" href="/Microsoft_Blog_Images/"><span></span>Microsoft Blog Images</a>
					
            </li>
        
			
            <li class="navigation-item last">
				<a id="MoreLink" style="display:none;" onmouseover="Core_GroupNavigation_MoreShowNav(ctl00_header_fragment_247403541, true, this)" onmouseout="Core_GroupNavigation_MoreMouseOutPopup(ctl00_header_fragment_247403541, true, this)" href="#">More ...</a>
            </li>
            </ul>
            <div class="navigation-list-footer"></div>
        
</div>
</div>
<div id="ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup" style="position:absolute;visibility:hidden;left:-5000px;"></div>
<div id="ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ParentMore" style="display: none;">
    <div class="content-list-header"></div>
    <ul id="ParentMoreListheader-fragment-247403541" class="content-list">
    </ul>
    <div class="content-list-footer"></div>
</div>
<div id="ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ChildMore" style="display: none;">
    <div class="content-list-header"></div>
    <ul id="ChildMoreListheader-fragment-247403541" class="content-list">
    </ul>
    <div class="content-list-footer"></div>
</div>
	
<script type="text/javascript">
    // <![CDATA[
    
    var Core_GroupNavigation_AjaxEndpoint = '/Utility/HeaderFragments/Core/GroupNavigationAjax.asmx';
        
    var ctl00_header_fragment_247403541={"wrapperId":"header-fragment-247403541","variableName":"ctl00_header_fragment_247403541","parameter":{"currentGroupId":0,"popupMenuId":"ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup","popupParentMoreId":"ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ParentMore","popupChildMoreId":"ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ChildMore","popupWrapperID":"popup-ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup","mouseInPopup":false,"popupPopulated":false,"errorHtml":"<div class=\"message error\">An error occured while attempting to load groups.</div>","loadingHtml":"<div class=\"message loading\">Loading...</div>","groupNavigationContentWrapperHtmlBlock":"<div id=\"popup-ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup\">{GroupNavigationContent}</div>","groupNavigationListHtmlBlock":"<div class=\"multiple-column-list-header\"></div>\n<div class=\"multiple-column-list columns-{ColumnsCount}\">{Columns}</div>\n<div class=\"multiple-column-list-footer\"></div>","columnWrapperHtmlBlock":"<div class=\"multiple-column-item column-{ColumnId}\">{T1GroupsData}</div>","t1GroupHtmlBlock":"\r\n\t\t<div class=\"content-list-header\"></div>\r\n\t\t<div class=\"content-list-name{NameClass}\">{Name}</div>\r\n\t\t<ul class=\"content-list\">\r\n\t\t\t{Groups}\r\n\t\t</ul>\r\n\t\t<div class=\"content-list-footer\"></div>\r\n\t","t2GroupHtmlBlock":"<li class=\"content-item{ItemClass}\">{Item}</li>","viewAllHtmlBlock":"<a href=\"{Url}\" class=\"internal-link view-all\">{Text}</a>","linkHtmlBlock":"<a href=\"{Url}\" class=\"{MoreClass}\">{Name}</a>","searchResultItemHtmlBlock":"<li class=\"content-item\"><a href=\"{Url}\">{Name}</a></li>","viewMoreText":"and {MoreText} more..."}};

	$(document).ready(function() {
		Core_GroupNavigation_SetMenuItems("#ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ParentGroupListContainer", true, "ParentMoreListheader-fragment-247403541");
		Core_GroupNavigation_SetMenuItems("#ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ChildGroupListContainer", false, "ChildMoreListheader-fragment-247403541");
	});

	$(window).resize(function() {
		Core_GroupNavigation_SetMenuItems("#ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ParentGroupListContainer", true, "ParentMoreListheader-fragment-247403541");
		Core_GroupNavigation_SetMenuItems("#ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_ChildGroupListContainer", false, "ChildMoreListheader-fragment-247403541");
	});
    // ]]>
</script></div></div></div></div>
<div class="header-fragments-footer"></div>
			
    <div class="content-fragment-page post" id="ctl00_content_ctl00_page"><div class="layout">
<div class="layout-header"></div>
<div class="layout-content header-top-content-left-sidebar-right" id="ctl00_content_ctl00_layout">
<div class="layout-region header" id="ctl00_content_ctl00_header">
<div class="layout-region-inner header"><div class="content-fragment blog-title full-border" id="fragment-16365">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">
<h1 class="title">
	    
			        
			    
	                x64 Manual Stack Reconstruction and Stack Walking
			    
	</h1></div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div id="fragment-16366"></div>
</div>
</div>
<div class="layout-region right-sidebar" id="ctl00_content_ctl00_right-sidebar">
<div class="layout-region-inner right-sidebar"><div class="content-fragment blog-links no-wrapper-with-spacing with-header" id="fragment-16367">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-header"><div>Common Tasks</div></div>
<div class="content-fragment-content">

		<div class="navigation-list-header"></div>
		<ul class="navigation-list">
	<li class="navigation-item"><a class="internal-link view-application" href="/b/ntdebugging/"><span></span>Blog Home</a></li><li class="navigation-item"><a class="internal-link view-user-profile" href="/b/ntdebugging/about.aspx"><span></span>About</a></li><li id=""RssComments""" class="navigation-item"><a class="internal-link rss" href="/b/ntdebugging/rsscomments.aspx"><span></span>RSS for comments</a></li><li class="navigation-item"><a class="internal-link rss" href="/b/ntdebugging/rss.aspx"><span></span>RSS for posts</a></li>
		</ul>
		<div class="navigation-list-footer"></div>
	</div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment search-form no-wrapper-with-spacing with-header" id="fragment-16368">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-header"><div>Search</div></div>
<div class="content-fragment-content">



        <div class="field-list-header"></div>
        <fieldset class="field-list">
            <ul class="field-list">
                <li class="field-item search">
                    <div>
                         <span class="field-item-input"><input name="ctl00$content$ctl00$w_16368$_9be11d$ctl00$ctl01$ctl01$Keywords" type="text" maxlength="64" size="45" id="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Keywords" onfocus="if(this.defaultValue==this.value) this.value='';" onblur="if(this.value=='') this.value=this.defaultValue;" /></span>
                    </div>
                    <span id="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator" style="color:Red;display:none;"><span class="field-item-validation">*</span></span>


                    <a href="#" onclick="ToggleAdvancedSearch(ctl00_content_ctl00_w_16368, this)" id="ctl00_content_ctl00_w_16368_AdvancedOptions" class="internal-link advanced-search"><span></span>Advanced search options...</a>
                </li>
                <li class="field-item search-type">
                    <label for="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_ContentTypes" class="field-item-header">Search In:</label>
                    <span class="field-item-input">
                        <select name="ctl00$content$ctl00$w_16368$_9be11d$ctl00$ctl01$ctl01$ContentTypes" id="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_ContentTypes">
	<option value="">Everything</option>
	<option value="blog">Blogs</option>
	<option value="forum">Forums</option>
	<option value="user">People</option>
	<option value="group">Groups</option>
	<option value="fileapp,forumapp,blogapp,wikiapp">Places</option>
	<option value="page">Pages</option>

</select>
                    </span>
                </li>
                <li class="field-item date-range">
                    <label for="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_DatingBackTo" class="field-item-header">Date range:</label>
                    <span class="field-item-input"><select name="ctl00$content$ctl00$w_16368$_9be11d$ctl00$ctl01$ctl01$DatingBackTo" id="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_DatingBackTo">
	<option value="-1">All Time</option>
	<option value="-365">Last Year</option>
	<option value="-185">Last 6 Months</option>
	<option value="-95">Last 3 Months</option>
	<option value="-35">Last Month</option>
	<option value="-7">Last Week</option>
	<option value="-2">Last Two Days</option>

</select></span>
                </li>
                
                <li class="field-item searchbutton">
                    <span class="field-item-input"><a id="ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_SearchButton" href="javascript:WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;ctl00$content$ctl00$w_16368$_9be11d$ctl00$ctl01$ctl01$SearchButton&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, true))">Search</a></span>
                </li>
            </ul>
        </fieldset>
        <div class="field-list-footer">
            <span style="display:inline-block"><input type="radio" name="SearchTypeRadio" value="ThisBlog" id="ThisBlog" checked /><label for="ThisBlog" id="ThisBlogText">Search this blog</label></span>
            <span style="display:inline-block"><input type="radio" name="SearchTypeRadio" value="AllBlogs" id="AllBlogs" /><label for="AllBlogs" id="AllBlogsText">Search all blogs</label></span>
        </div>

    


<script type="text/javascript">

// Hide the radio buttons and text if we aren't on a blog
$(document).ready(function() {
            
    // try to get the blog id, if we fail, then we aren't on a blog and just use the regular search approach       
    var sectionID = 7700;

    if (sectionID == -1)
    {
        var tbObj = document.getElementById("ThisBlog");
        var tbObjText = document.getElementById("ThisBlogText");
        var abObj = document.getElementById("AllBlogs");
        var abObjText = document.getElementById("AllBlogsText");
        
        if (tbObj != 'undefined' && abObj != 'undefined' && abObjText != 'undefined' && tbObjText != 'undefined')
        {
            tbObj.style.display = 'none';
            tbObjText.style.display = 'none';
            abObj.style.display = 'none';
            abObjText.style.display = 'none';
        }
    }
}
);

// Setup on keypress event for the search box     
var ctl00_content_ctl00_w_16368={"wrapperId":"fragment-16368","variableName":"ctl00_content_ctl00_w_16368","parameter":{"keywords":"ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Keywords","search":"ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_SearchButton"}};
    
    $("#" + ctl00_content_ctl00_w_16368.parameter.keywords).bind("keypress", function(event) {
        if (event.keyCode == 13) {
            event.preventDefault();
            var tb = $(event.target);
            tb.blur();   
            
            // try to get the blog id, if we fail, then we aren't on a blog and just use the regular search approach       
            var sectionID = 7700;
            if (sectionID != -1 && document.getElementById("ThisBlog").checked==true)
            {
                window.location = "/search/SearchResults.aspx?q=" + encodeURIComponent($("#" + ctl00_content_ctl00_w_16368.parameter.keywords).attr("value")) + "&sections=" + sectionID;
            }
            else
            {
                window.location = $("#" + ctl00_content_ctl00_w_16368.parameter.search).attr("href");
            }
        }
    });
    
    function ToggleAdvancedSearch(context, e)
    {
        var wrapper = $("#" + context.wrapperId);
        var advancedSearchLink = $("#" + context.variableName + "_AdvancedOptions", wrapper);
        if (advancedSearchLink.text() == 'Advanced search options...')
        {
            advancedSearchLink.text('Hide advanced options...');
            $("ul.field-list", wrapper).addClass('advanced-search advanced-search__field-list');
        }
        else
        {
            advancedSearchLink.text('Advanced search options...');
            $("ul.field-list", wrapper).removeClass('advanced-search advanced-search__field-list');
        }
    }
</script></div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment blog-post-list no-wrapper-with-spacing with-header" id="fragment-16369">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-header"><div>Recent Posts</div></div>
<div class="content-fragment-content">

	    <div class="content-list-header simple"></div>
        <ul class="content-list simple">
	
		<li class="content-item">
			<div class="abbreviated-post-header"></div>
			<div class="abbreviated-post">
				<h4 class="post-name"><a class="internal-link view-post" href="/b/ntdebugging/archive/2011/08/05/for-testing-purposes-only-and-other-desktop-watermarks.aspx"><span></span>For testing purposes only, and other desktop watermarks</a></h4>
				
            <div class="post-date">
		        <span class="label">Posted</span>
		        <span class="value">10 days ago</span>
	        </div>
                <div class="post-author">
                    <span class="fiji-post-author-by">by</span>
                    <span class="avatar"><a href="/ntdebug/ProfileUrlRedirect.ashx"><img src="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=ntdebug&amp;size=large" alt="" style="border-width:0px;max-height:32px;max-width:32px;" /></a></span>
                    
                    <span class="user-name"><a class="internal-link view-user-profile" href="/ntdebug/ProfileUrlRedirect.ashx"><span></span>ntdebug</a></span>
                    
                </div>
	            <div class="post-attributes">
		                <div class="attribute-list-header"></div>
                        <ul class="attribute-list">
                            <span class="attribute-value">2</span>
                            <span class="attribute-name">Comments</span>
                        </ul>
                        <div class="attribute-list-footer"></div>
                    </div>
			</div>
			<div class="abbreviated-post-footer"></div>
		</li>
	
		<li class="content-item">
			<div class="abbreviated-post-header"></div>
			<div class="abbreviated-post">
				<h4 class="post-name"><a class="internal-link view-post" href="/b/ntdebugging/archive/2011/07/21/lun-discovery-in-a-nutshell.aspx"><span></span>LUN Discovery in a Nutshell</a></h4>
				
            <div class="post-date">
		        <span class="label">Posted</span>
		        <span class="value">25 days ago</span>
	        </div>
                <div class="post-author">
                    <span class="fiji-post-author-by">by</span>
                    <span class="avatar"><a href="/ntdebug/ProfileUrlRedirect.ashx"><img src="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=ntdebug&amp;size=large" alt="" style="border-width:0px;max-height:32px;max-width:32px;" /></a></span>
                    
                    <span class="user-name"><a class="internal-link view-user-profile" href="/ntdebug/ProfileUrlRedirect.ashx"><span></span>ntdebug</a></span>
                    
                </div>
	            <div class="post-attributes">
		                <div class="attribute-list-header"></div>
                        <ul class="attribute-list">
                            <span class="attribute-value">1</span>
                            <span class="attribute-name">Comments</span>
                        </ul>
                        <div class="attribute-list-footer"></div>
                    </div>
			</div>
			<div class="abbreviated-post-footer"></div>
		</li>
	
		<li class="content-item">
			<div class="abbreviated-post-header"></div>
			<div class="abbreviated-post">
				<h4 class="post-name"><a class="internal-link view-post" href="/b/ntdebugging/archive/2011/07/20/updated-archive-of-the-debug-ninja-s-twitter-debug-tips.aspx"><span></span>Updated Archive of the Debug Ninja’s Twitter Debug Tips</a></h4>
				
            <div class="post-date">
		        <span class="label">Posted</span>
		        <span class="value">26 days ago</span>
	        </div>
                <div class="post-author">
                    <span class="fiji-post-author-by">by</span>
                    <span class="avatar"><a href="/ntdebug/ProfileUrlRedirect.ashx"><img src="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=ntdebug&amp;size=large" alt="" style="border-width:0px;max-height:32px;max-width:32px;" /></a></span>
                    
                    <span class="user-name"><a class="internal-link view-user-profile" href="/ntdebug/ProfileUrlRedirect.ashx"><span></span>ntdebug</a></span>
                    
                </div>
	            <div class="post-attributes">
		                <div class="attribute-list-header"></div>
                        <ul class="attribute-list">
                            <span class="attribute-value">1</span>
                            <span class="attribute-name">Comments</span>
                        </ul>
                        <div class="attribute-list-footer"></div>
                    </div>
			</div>
			<div class="abbreviated-post-footer"></div>
		</li>
	
		<li class="content-item">
			<div class="abbreviated-post-header"></div>
			<div class="abbreviated-post">
				<h4 class="post-name"><a class="internal-link view-post" href="/b/ntdebugging/archive/2011/06/29/a-classic-case-of-whodunit.aspx"><span></span>A Classic Case of Whodunit</a></h4>
				
            <div class="post-date">
		        <span class="label">Posted</span>
		        <span class="value">1 month ago</span>
	        </div>
                <div class="post-author">
                    <span class="fiji-post-author-by">by</span>
                    <span class="avatar"><a href="/ntdebug/ProfileUrlRedirect.ashx"><img src="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=ntdebug&amp;size=large" alt="" style="border-width:0px;max-height:32px;max-width:32px;" /></a></span>
                    
                    <span class="user-name"><a class="internal-link view-user-profile" href="/ntdebug/ProfileUrlRedirect.ashx"><span></span>ntdebug</a></span>
                    
                </div>
	            <div class="post-attributes">
		                <div class="attribute-list-header"></div>
                        <ul class="attribute-list">
                            <span class="attribute-value">3</span>
                            <span class="attribute-name">Comments</span>
                        </ul>
                        <div class="attribute-list-footer"></div>
                    </div>
			</div>
			<div class="abbreviated-post-footer"></div>
		</li>
	
		<li class="content-item">
			<div class="abbreviated-post-header"></div>
			<div class="abbreviated-post">
				<h4 class="post-name"><a class="internal-link view-post" href="/b/ntdebugging/archive/2011/06/28/ntfs-and-4k-disks.aspx"><span></span>NTFS And 4K Disks</a></h4>
				
            <div class="post-date">
		        <span class="label">Posted</span>
		        <span class="value">1 month ago</span>
	        </div>
                <div class="post-author">
                    <span class="fiji-post-author-by">by</span>
                    <span class="avatar"><a href="/ntdebug/ProfileUrlRedirect.ashx"><img src="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=ntdebug&amp;size=large" alt="" style="border-width:0px;max-height:32px;max-width:32px;" /></a></span>
                    
                    <span class="user-name"><a class="internal-link view-user-profile" href="/ntdebug/ProfileUrlRedirect.ashx"><span></span>ntdebug</a></span>
                    
                </div>
	            <div class="post-attributes">
		                <div class="attribute-list-header"></div>
                        <ul class="attribute-list">
                            <span class="attribute-value">1</span>
                            <span class="attribute-name">Comments</span>
                        </ul>
                        <div class="attribute-list-footer"></div>
                    </div>
			</div>
			<div class="abbreviated-post-footer"></div>
		</li>
	
		</ul>
		<div class="content-list-footer simple"></div>
	</div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment blog-archive-list no-wrapper-with-spacing with-header" id="fragment-16370">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-header"><div>Archives</div></div>
<div class="content-fragment-content">

		<div class="content-list-header"></div>
		<div class="content-list-name">Archives</div>
		<ul class="content-list">
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/08.aspx">August 2011</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/07.aspx">July 2011</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/06.aspx">June 2011</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/05.aspx">May 2011</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/04.aspx">April 2011</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/03.aspx">March 2011</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/02.aspx">February 2011</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2011/01.aspx">January 2011</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/11.aspx">November 2010</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/09.aspx">September 2010</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/08.aspx">August 2010</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/07.aspx">July 2010</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/06.aspx">June 2010</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/05.aspx">May 2010</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/04.aspx">April 2010</a> (7)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/03.aspx">March 2010</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/02.aspx">February 2010</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2010/01.aspx">January 2010</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/12.aspx">December 2009</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/11.aspx">November 2009</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/10.aspx">October 2009</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/09.aspx">September 2009</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/08.aspx">August 2009</a> (7)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/07.aspx">July 2009</a> (4)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/06.aspx">June 2009</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/05.aspx">May 2009</a> (6)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/04.aspx">April 2009</a> (4)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/03.aspx">March 2009</a> (13)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/02.aspx">February 2009</a> (6)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2009/01.aspx">January 2009</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/12.aspx">December 2008</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/11.aspx">November 2008</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/10.aspx">October 2008</a> (5)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/09.aspx">September 2008</a> (4)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/08.aspx">August 2008</a> (6)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/07.aspx">July 2008</a> (7)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/06.aspx">June 2008</a> (6)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/05.aspx">May 2008</a> (11)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/04.aspx">April 2008</a> (14)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/03.aspx">March 2008</a> (6)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2008/02.aspx">February 2008</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/12.aspx">December 2007</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/11.aspx">November 2007</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/10.aspx">October 2007</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/09.aspx">September 2007</a> (6)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/07.aspx">July 2007</a> (3)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/06.aspx">June 2007</a> (10)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/05.aspx">May 2007</a> (1)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2007/01.aspx">January 2007</a> (2)</li>
	
		<li class="content-item"><a class="internal-link view-post-archive-list" href="/b/ntdebugging/archive/2006/12.aspx">December 2006</a> (2)</li>
	
		</ul>
		<div class="content-list-footer"></div>
	
</div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment link-list no-wrapper-with-spacing" id="fragment-16371">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">

        <div class="content-list-header"></div>
        <div class="content-list-name">History</div>
        <ul class="content-list">
            
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.msdn.com/ntdebugging/pages/nt-debugging-blog-history.aspx"><span></span>List all articles</a></h3>
                            <div class="post-content user-defined-markup">a list of all ntdebugging articles.</div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
        </ul>
        <div class="content-list-footer"></div>
    
        <div class="content-list-header"></div>
        <div class="content-list-name">Associated team blogs</div>
        <ul class="content-list">
            
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/askcore"><span></span>Core </a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/askds"><span></span>Directory Services </a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/latam"><span></span>LATAM [Portugese & Spanish] </a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/smsandmom"><span></span>Manageability</a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/networking"><span></span>Networking</a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/askperf"><span></span>Performance</a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/sbs"><span></span>Small Business Server </a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/softgrid"><span></span>SoftGrid</a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
                    <li class="content-item">
                        <div class="full-post-header"></div>
                        <div class="full-post">
                            <h3 class="post-name"><a class="external-link view-post" href="http://blogs.technet.com/hot"><span></span>Microsoft Hotfix and Hot Issue Center!</a></h3>
                            <div class="post-content user-defined-markup"></div>
                        </div>
                        <div class="full-post-footer"></div>
                    </li>
                
        </ul>
        <div class="content-list-footer"></div>
    </div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
</div>
</div>
<div class="layout-region content" id="ctl00_content_ctl00_content">
<div class="layout-region-inner content"><div class="content-fragment blog-bread-crumbs no-wrapper-with-spacing" id="fragment-16372">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">


<div class="breadcrumb-list-header"></div>
<div class="breadcrumb-list">
	<span class="breadcrumb-item"><a class="internal-link view-home" href="/">MSDN Blogs</a></span>
  
	

	
			<span class="separator"> > </span>
			<span class="breadcrumb-item">
		<a href="/b/ntdebugging/">Ntdebugging Blog</a>
			</span>
		
	
	
			<span class="separator"> > </span>
			<span class="breadcrumb-item">
		<a href="/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx">x64 Manual Stack Reconstruction and Stack Walking</a>
			</span>
		

	
</div>
<div class="breadcrumb-list-footer"></div>
</div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment blog-post no-wrapper-with-spacing" id="fragment-16373">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">

<div class="full-post-header"></div>
<div class="full-post">
	<h3 class="post-name">x64 Manual Stack Reconstruction and Stack Walking</h3>
	
	        <div class="post-rating">
	            Rate This<br />
	    <span id="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01" title="Rated Excellent [5 out of 5]."></span><input type="hidden" value="5" id="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01_Value" />
	        </div>
	    
    <div class="post-author">
        <span class="avatar"><a href="/ntdebug/ProfileUrlRedirect.ashx"><img src="http://i1.social.microsoft.com/profile/u/avatar.jpg?displayname=ntdebug&amp;size=large" alt="" style="border-width:0px;max-height:32px;max-width:32px;" /></a></span>
        
        <span class="profile-usercard-hover" data-profile-userid="c8fba3fb-5aef-4da6-bd87-2e58de1cc912">
            <span class="user-name"><a class="internal-link view-user-profile" href="/ntdebug/ProfileUrlRedirect.ashx"><span></span>ntdebug</a></span>
        
            
        </span>
    </div>
    <div class="post-date">
        <span class="value">
            12 May 2010 10:14 AM
        </span>
    </div>
    <div class="post-attributes">
        <div class="attribute-list-header"></div>
        <ul class="attribute-list">
             <li class="attribute-item post-reply-count">
                <span class="attribute-name">Comments</span>
                <span class="attribute-value"><a href="#comments" class="internal-link view-replies"><span></span>0</a></span>
             </li>
        </ul>
        <div class="attribute-list-footer"></div>
    </div>
    <div class="post-content user-defined-markup"><P style="MARGIN: 0in 0in 10pt" class=MsoNormal><SPAN style="mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-hansi-theme-font: minor-latin; mso-bidi-theme-font: minor-latin"><FONT size=3 face=Calibri>My name is </FONT><A href="http://www.treynash.net/" target=_blank mce_href="http://www.treynash.net/"><SPAN style="mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin"><FONT color=#0000ff size=3 face="Times New Roman">Trey Nash</FONT></SPAN></A><FONT face=Calibri><FONT size=3> and I am an Escalation Engineer on the Core OS team.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>My experience is as a software developer, and therefore my blog posts tend to be slanted in the direction of helping developers during the feature development, testing and the support phases.<?xml:namespace prefix = o ns = "urn:schemas-microsoft-com:office:office" /><o:p></o:p></FONT></FONT></SPAN></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><SPAN style="mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-hansi-theme-font: minor-latin; mso-bidi-theme-font: minor-latin"><FONT size=3 face=Calibri>In this installment I would like to expand a bit on a previous post of mine called </FONT><A href="http://blogs.msdn.com/ntdebugging/archive/2009/01/09/challenges-of-debugging-optimized-x64-code.aspx" target=_blank mce_href="http://blogs.msdn.com/ntdebugging/archive/2009/01/09/challenges-of-debugging-optimized-x64-code.aspx"><SPAN style="mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin"><FONT size=3 face=Calibri>Challenges of Debugging Optimized x64 Code</FONT></SPAN></A><FONT face=Calibri><FONT size=3>.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In that post I discussed the nuances of the x64 calling convention (thankfully of which there is only one) and how it is used in optimized builds of software.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The calling convention is sometimes referred to as the Application Binary Interface (ABI).<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In this post, I would like to discuss the x64 unwind metadata and how you can use it in the debugger to manually walk a stack.<o:p></o:p></FONT></FONT></SPAN></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><SPAN style="mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-hansi-theme-font: minor-latin; mso-bidi-theme-font: minor-latin"><FONT size=3 face=Calibri>In some cases, you may have a corrupted stack that the debugger simply cannot effectively walk for you.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>This often happens because the debugger walks a stack from the top down (assuming the stack grows upwards as if it were a stack of places on a table), and if the stack is sufficiently trashed then the debugger cannot find its bearing.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In the x86 world, a large percentage of the time, you can spot the stack frames by following the chain of base pointers and then build a crafty stack backtrace command to display the stack at some point in time.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>But in the x64 calling convention there is no base pointer.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In fact, once a function’s prolog code has executed the rsp register generally never changes until the epilog code.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>To read more about x64 prolog and epilog code conventions, go </FONT><A href="http://msdn.microsoft.com/en-us/library/tawsa7cb.aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/tawsa7cb.aspx"><SPAN style="mso-bidi-font-family: Calibri; mso-bidi-theme-font: minor-latin"><FONT color=#0000ff size=3 face="Times New Roman">here</FONT></SPAN></A><FONT face=Calibri><FONT size=3>.<o:p></o:p></FONT></FONT></SPAN></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri><SPAN style="mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-bidi-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-hansi-theme-font: minor-latin; mso-bidi-theme-font: minor-latin">Moreover, the syntax for creating a crafty stack backtrace command in the x64 environment is currently undocumented, and I aim to shed some light on that near the end of that blog post</SPAN>. </FONT><SPAN style="FONT-FAMILY: Wingdings; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-char-type: symbol; mso-symbol-font-family: Wingdings"><SPAN style="mso-char-type: symbol; mso-symbol-font-family: Wingdings">J</SPAN></SPAN><o:p></o:p></FONT></P>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>The Example Code<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>For this blog post I have used the following example C# code that requires the .NET 4.0 framework and can be easily built from a Visual Studio 2010 command prompt.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>You can find the code below:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">using System;<BR>using System.Numerics;<BR>using System.Threading;<BR>using System.Threading.Tasks;<BR>using System.Collections.Concurrent;<BR><BR>class EntryPoint<BR>{<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>const int FactorialsToCompute = 2000;<BR><BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>static void Main() {<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>var numbers = new ConcurrentDictionary&lt;BigInteger, BigInteger&gt;(4, FactorialsToCompute);<BR><BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// Create a factorial delegate.<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Func&lt;BigInteger, BigInteger&gt; factorial = null;<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>factorial = (n) =&gt; ( n == 0 ) ? 1 : n * factorial(n-1);<BR><BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// Now compute the factorial of the list<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>// concurrently.<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Parallel.For( 0,<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>FactorialsToCompute,<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>(i) =&gt; {<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>numbers[i] = factorial(i);<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>} );<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>}<BR>}<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3 face=Calibri>The spirit of this code is to concurrently compute the first 2000 factorials and store the results in a dictionary.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>This code uses the new </FONT><A href="http://msdn.microsoft.com/en-us/library/dd537608(v=VS.100).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/dd537608(v=VS.100).aspx"><FONT color=#0000ff size=3 face="Times New Roman">Task Parallel Library</FONT></A><FONT size=3><FONT face=Calibri> to distribute this work evenly across the multiple cores on the system.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>To compile the example (assuming the code is stored in test.cs), you can execute the following command from a Visual Studio 2010 command prompt:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=DebuggerSpew><FONT style="BACKGROUND-COLOR: #f2f2f2"><FONT face="Courier New">csc /r:system.numerics.dll test.cs<o:p></o:p></FONT></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT size=3 face=Calibri>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>If you are using a 64bit platform, be sure to use the x64 command prompt shortcut installed by the Visual Studio 2010 installer.<BR><BR>You can download a free evaluation of Visual Studio 2010 </FONT><A href="http://www.microsoft.com/visualstudio/en-us/" target=_blank mce_href="http://www.microsoft.com/visualstudio/en-us/"><FONT color=#0000ff size=3 face="Times New Roman">here</FONT></A><FONT size=3><FONT face=Calibri>.<o:p></o:p></FONT></FONT></P></DIV>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>x64 Unwind Metadata<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3 face=Calibri>So how does the debugger and functions such as </FONT><A href="http://msdn.microsoft.com/en-us/library/ms680617(VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ms680617(VS.85).aspx"><FONT color=#0000ff size=3 face="Times New Roman">RtlVirtualUnwind</FONT></A><FONT size=3><FONT face=Calibri> know how to walk the x64 stack if it cannot find a base pointer?<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The secret is that it uses unwind metadata that is typically baked into the Portable Executable (PE) file at link time. You can inspect this information using the /UNWINDINFO option of the command line tool dumpbin.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>For example, I went to the directory on my machine which contains clr.dll (c:\Windows\Microsoft.NET\Framework\v4.0.30319) and dumped the unwind info looking for CLREvent::WaitEx, which I have pasted below:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00013F20 000DFDB0 000DFE3C 007267D8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>?WaitEx@CLREvent@@QEAAKKW4WaitMode@@PEAUPendingSync@@@Z (public: unsigned long __cdecl CLREvent::WaitEx(unsigned long,enum WaitMode,struct PendingSync *))<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Unwind version: 1<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Unwind flags: UHANDLER<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Size of prologue: 0x20<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Count of codes: 10<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Unwind codes:<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>20: SAVE_NONVOL, register=rbp offset=0xB0<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>1C: SAVE_NONVOL, register=rbx offset=0xA8<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0F: ALLOC_SMALL, size=0x70<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0B: PUSH_NONVOL, register=r14<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>09: PUSH_NONVOL, register=r13<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>07: PUSH_NONVOL, register=r12<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>05: PUSH_NONVOL, register=rdi<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>04: PUSH_NONVOL, register=rsi<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>Handler: 0020ADF0 __CxxFrameHandler3<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>EH Handler Data: 007B3F54<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT face=Calibri><FONT size=3>I’ll get into what all of this means shortly.<o:p></o:p></FONT></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT face=Calibri><FONT size=3>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>The dumpbin.exe functionality is also exposed via the linker.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>For example, the command “dumpbin.exe /?” is identical to “link.exe /dump /?”.<o:p></o:p></FONT></FONT></P></DIV>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3 face=Calibri></FONT>&nbsp;</P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3 face=Calibri>Within the debugger, you can find this same information for a particular function using the </FONT><A href="http://msdn.microsoft.com/en-us/library/ff563104.aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ff563104.aspx"><FONT color=#0000ff size=3 face="Times New Roman">.fnent</FONT></A><FONT size=3><FONT face=Calibri> command.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>To demonstrate, I executed the example code within a windbg instance and broke in at some random point and chose one of the threads to look at which has a stack looking like the following:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>12<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Id: f80.7f0 Suspend: 1 Teb: 000007ff`fffa0000 Unfrozen<BR><SPAN style="mso-spacerun: yes">&nbsp;</SPAN># Child-SP<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>RetAddr<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Call Site<BR>00 00000000`04a51e18 000007fe`fd4e10ac ntdll!NtWaitForSingleObject+0xa<BR>01 00000000`04a51e20 000007fe`f48bffc7 KERNELBASE!WaitForSingleObjectEx+0x79<BR>02 00000000`04a51ec0 000007fe`f48bff70 clr!CLREvent::WaitEx+0x170<BR>03 00000000`04a51f00 000007fe`f48bfe23 clr!CLREvent::WaitEx+0xf8<BR><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">04 00000000`04a51f60 000007fe`f48d51d8 clr!CLREvent::WaitEx+0x5e</SPAN><BR>05 00000000`04a52000 000007fe`f4995249 clr!SVR::gc_heap::wait_for_gc_done+0x98<BR>06 00000000`04a52030 000007fe`f48aef28 clr!SVR::GCHeap::Alloc+0xb4<BR>07 00000000`04a520a0 000007fe`f48aecc9 clr!FastAllocatePrimitiveArray+0xc5<BR>08 00000000`04a52120 000007fe`f071244c clr!JIT_NewArr1+0x389<BR>09 00000000`04a522f0 000007fe`f07111b5 System_Numerics_ni+0x2244c<BR>0a 00000000`04a52330 000007ff`00150acf System_Numerics_ni+0x211b5<BR>0b 00000000`04a523d0 000007ff`0015098c 0x7ff`00150acf<BR>0c 00000000`04a52580 000007ff`0015098c 0x7ff`0015098c<BR>0d 00000000`04a52730 000007ff`0015098c 0x7ff`0015098c<BR>0e 00000000`04a528e0 000007ff`0015098c 0x7ff`0015098c<BR>0f 00000000`04a52a90 000007ff`0015098c 0x7ff`0015098c<BR>10 00000000`04a52c40 000007ff`0015098c 0x7ff`0015098c<BR>11 00000000`04a52df0 000007ff`0015098c 0x7ff`0015098c<BR>12 00000000`04a52fa0 000007ff`0015098c 0x7ff`0015098c<BR>13 00000000`04a53150 000007ff`0015098c 0x7ff`0015098c<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>At first glance, it may appear that this stack is already trashed since there is no symbol information for the bottom frames in the display.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Before jumping to this conclusion, recall that this is a managed application and therefore contains JIT compiled code.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>To verify that the addresses without symbol information are JIT’ed code, you can do a couple of things.<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>First, use the !EEHeap extension in the SOS extension to determine if these addresses reside in the JIT code heap.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Below, you can see the commands I used to both load the SOS extension and then display the Execution Engine (EE) Heap information:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:014&gt; .loadby sos clr<BR><BR>0:014&gt; !EEHeap -loader<BR>Loader Heap:<BR>--------------------------------------<BR>System Domain:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007fef50955a0<BR>LowFrequencyHeap:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007ff00020000(2000:1000) Size: 0x1000 (4096) bytes.<BR>HighFrequencyHeap: 000007ff00022000(8000:1000) Size: 0x1000 (4096) bytes.<BR>StubHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff0002a000(2000:2000) Size: 0x2000 (8192) bytes.<BR>Virtual Call Stub Heap:<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>IndcellHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff000d0000(6000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>LookupHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff000dc000(4000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>ResolveHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff00106000(3a000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>DispatchHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>000007ff000e0000(26000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>CacheEntryHeap:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Size: 0x0 (0) bytes.<BR>Total size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Size: 0x8000 (32768) bytes.<BR>--------------------------------------<BR>Shared Domain:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007fef5095040<BR>LowFrequencyHeap:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007ff00020000(2000:1000) Size: 0x1000 (4096) bytes.<BR>HighFrequencyHeap: 000007ff00022000(8000:1000) Size: 0x1000 (4096) bytes.<BR>StubHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff0002a000(2000:2000) Size: 0x2000 (8192) bytes.<BR>Virtual Call Stub Heap:<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>IndcellHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff000d0000(6000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>LookupHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff000dc000(4000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>ResolveHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff00106000(3a000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>DispatchHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>000007ff000e0000(26000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>CacheEntryHeap:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Size: 0x0 (0) bytes.<BR>Total size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Size: 0x8000 (32768) bytes.<BR>--------------------------------------<BR>Domain 1:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>00000000003e73c0<BR>LowFrequencyHeap:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007ff00030000(2000:1000) 000007ff00140000(10000:5000) Size: 0x6000 (24576) bytes total, 0x1000 (4096) bytes wasted.<BR>HighFrequencyHeap: 000007ff00032000(8000:5000) Size: 0x5000 (20480) bytes.<BR>StubHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Size: 0x0 (0) bytes.<BR>Virtual Call Stub Heap:<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>IndcellHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff00040000(4000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>LookupHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff0004b000(2000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>ResolveHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>000007ff0007c000(54000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>DispatchHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>000007ff0004d000(2f000:1000) Size: 0x1000 (4096) bytes.<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>CacheEntryHeap:<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Size: 0x0 (0) bytes.<BR>Total size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;</SPAN>Size: 0xf000 (61440) bytes total, 0x1000 (4096) bytes wasted.<BR>--------------------------------------<BR></FONT><FONT face="Courier New"><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">Jit code heap:<BR>LoaderCodeHeap:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>000007ff00150000(40000:2000) Size: 0x2000 (8192) bytes.<BR>Total size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Size: 0x2000 (8192) bytes.</SPAN><BR>--------------------------------------<BR>Module Thunk heaps:<BR>Module 000007fee5581000: Size: 0x0 (0) bytes.<BR>Module 000007ff000330d8: Size: 0x0 (0) bytes.<BR>Module 000007fef06f1000: Size: 0x0 (0) bytes.<BR>Total size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Size: 0x0 (0) bytes.<BR>--------------------------------------<BR>Module Lookup Table heaps:<BR>Module 000007fee5581000: Size: 0x0 (0) bytes.<BR>Module 000007ff000330d8: Size: 0x0 (0) bytes.<BR>Module 000007fef06f1000: Size: 0x0 (0) bytes.<BR>Total size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Size: 0x0 (0) bytes.<BR>--------------------------------------<BR>Total LoaderHeap size:<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>Size: 0x21000 (135168) bytes total, 0x1000 (4096) bytes wasted.</FONT><SPAN class=DebuggerSpewChar><BR></SPAN><FONT face="Courier New">=======================================<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT face=Calibri><FONT size=3>I have highlighted the JIT heap information and you can see that the JIT’ed code instruction pointers in the stack fall within this range. <o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3 face=Calibri>The second sanity check you can perform is to use a variant of the </FONT><A href="http://msdn.microsoft.com/en-us/library/ff560235(v=VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ff560235(v=VS.85).aspx"><FONT color=#0000ff size=3 face="Times New Roman">u</FONT></A><FONT size=3><FONT face=Calibri> instruction to confirm that there is a call instruction just prior to that address as shown below:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; ub 0x7ff`0015098c<BR>000007ff`0015095e 488b01<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>rax,qword ptr [rcx]<BR>000007ff`00150961 48898424b0000000 mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>qword ptr [rsp+0B0h],rax<BR>000007ff`00150969 488b4108<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>rax,qword ptr [rcx+8]<BR>000007ff`0015096d 48898424b8000000 mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>qword ptr [rsp+0B8h],rax<BR>000007ff`00150975 4c8d8424b0000000 lea<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>r8,[rsp+0B0h]<BR>000007ff`0015097d 488b5308<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>rdx,qword ptr [rbx+8]<BR>000007ff`00150981 488d8c24c0000000 lea<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>rcx,[rsp+0C0h]<BR>000007ff`00150989 ff5318<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">call<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>qword ptr [rbx+18h]</SPAN><o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>So at this point we have verified that we probably have a valid stack.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>But how does the debugger so effectively walk this stack for us if there is no stack frame pointer?<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The answer, of course, is that it uses the unwind information.<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>To explore the answer to that question, let’s focus on a particular frame within the stack such as frame 4 in the stack above.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The code at that frame is inside the function clr!CLREvent::WaitEx, and if we pass that to .fnent, we get the following output:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; .fnent clr!CLREvent::WaitEx<BR>Debugger function entry 00000000`04075e40 for:<BR>(000007fe`f48bfdb0)<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>clr!CLREvent::WaitEx<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>(000007fe`f48bfe3c)<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>clr!CLREvent::Set<BR>Exact matches:<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>clr!CLREvent::WaitEx = &lt;no type information&gt;<BR><BR>BeginAddress<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>= 00000000`000dfdb0<BR>EndAddress<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>= 00000000`000dfe3c<BR>UnwindInfoAddress = <SPAN style="BACKGROUND: lime; mso-highlight: lime">00000000`007267d8</SPAN><BR><BR>Unwind info at <SPAN style="BACKGROUND: yellow; mso-highlight: yellow">000007fe`f4f067d8</SPAN>, 20 bytes<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>version 1, flags 2, prolog 20, codes a<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>frame reg 0, frame offs 0<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>handler routine: clr!_CxxFrameHandler3 (000007fe`f49eadf0), data 7b3f54<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00: offs 20, unwind op 4, op info 5<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>UWOP_SAVE_NONVOL FrameOffset: b0<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>02: offs 1c, unwind op 4, op info 3<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>UWOP_SAVE_NONVOL FrameOffset: a8<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>04: offs f, unwind op 2, op info d<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_ALLOC_SMALL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>05: offs b, unwind op 0, op info e<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>06: offs 9, unwind op 0, op info d<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>07: offs 7, unwind op 0, op info c<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>08: offs 5, unwind op 0, op info 7<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>09: offs 4, unwind op 0, op info 6<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri><SPAN style="mso-spacerun: yes">&nbsp;</SPAN>Notice that this output is virtually identical to the same information provided by dumpbin using the /UNWINDINFO option.<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>I have highlighted two interesting values above.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The value highlighted in <SPAN style="BACKGROUND: lime; mso-highlight: lime">green</SPAN> is a relative virtual address (RVA) to the unwind info that is baked into the PE file by the linker.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The value highlighted in <SPAN style="BACKGROUND: yellow; mso-highlight: yellow">yellow</SPAN> is the actual virtual address of the unwind info and can be computed by adding the <SPAN style="BACKGROUND: aqua; mso-highlight: aqua">module base address</SPAN> shown below to the RVA for <SPAN style="BACKGROUND: lime; mso-highlight: lime">UnwindInfoAddress</SPAN>. <o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; lmnm clr<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">start<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>end<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>module name<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New"><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">000007fe`f47e0000</SPAN> 000007fe`f5145000<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>clr<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>By examining the PE header using !dh you can confirm that the unwind information resides in the .rdata section of the module, which I have shown below:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; !dh clr<BR><BR>File Type: DLL<BR>FILE HEADER VALUES<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>8664 machine (X64)<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>6 number of sections<BR>4BA21EEB time date stamp Thu Mar 18 07:39:07 2010<BR><BR>&lt;snip&gt;<BR>SECTION HEADER #2<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>.rdata name<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>1FC8EC virtual size<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">67F000</SPAN> virtual address<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">1FCA00</SPAN> size of raw data<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>67E200 file pointer to raw data<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0 file pointer to relocation table<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0 file pointer to line numbers<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0 number of relocations<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>0 number of line numbers<BR>40000040 flags<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Initialized Data<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>(no align specified)<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Read Only<BR>&lt;snip&gt;<o:p></o:p></FONT></P>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>Using the Unwind Info<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>Now let’s take a look at the unwind info and compare it to the prolog code of the function with which it is associated.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>For convenience, I have reprinted the .fnent output for the function:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; .fnent clr!CLREvent::WaitEx<BR>Debugger function entry 00000000`04075e40 for:<BR>(000007fe`f48bfdb0)<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>clr!CLREvent::WaitEx<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>|<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>(000007fe`f48bfe3c)<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>clr!CLREvent::Set<BR>Exact matches:<BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>clr!CLREvent::WaitEx = &lt;no type information&gt;<BR><BR>BeginAddress<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>= 00000000`000dfdb0<BR>EndAddress<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>= 00000000`000dfe3c<BR>UnwindInfoAddress = 00000000`007267d8<BR><BR>Unwind info at 000007fe`f4f067d8, 20 bytes<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>version 1, flags 2, <SPAN style="BACKGROUND: yellow; mso-highlight: yellow">prolog 20</SPAN>, codes a<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>frame reg 0, frame offs 0<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>handler routine: clr!_CxxFrameHandler3 (000007fe`f49eadf0), data 7b3f54<BR></FONT><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: darkred; COLOR: white; mso-highlight: darkred"><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00: offs 20, unwind op 4, op info 5<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>UWOP_SAVE_NONVOL FrameOffset: b0<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>02: offs 1c, unwind op 4, op info 3<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>UWOP_SAVE_NONVOL FrameOffset: a8<BR></FONT></SPAN><SPAN style="COLOR: white"><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: blue; mso-highlight: blue">04: offs f, unwind op 2, op info d<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_ALLOC_SMALL</SPAN><BR></FONT></SPAN></B><SPAN style="BACKGROUND: aqua; mso-highlight: aqua"><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>05: offs b, unwind op 0, op info e<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>06: offs 9, unwind op 0, op info d<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>07: offs 7, unwind op 0, op info c<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>08: offs 5, unwind op 0, op info 7<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<BR><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>09: offs 4, unwind op 0, op info 6<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<o:p></o:p></FONT></SPAN></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>The yellow highlighted value tells us that the prolog code for the function is 0x20 bytes in length. Using that information we can dump out the prolog code for the function:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; u clr!CLREvent::WaitEx clr!CLREvent::WaitEx<SPAN style="BACKGROUND: yellow; mso-highlight: yellow">+20</SPAN><BR>clr!CLREvent::WaitEx:<BR>000007fe`f48bfdb0 488bc4<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>rax,rsp<BR>000007fe`f48bfdb3 56<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">push<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>rsi</SPAN><BR>000007fe`f48bfdb4 57<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">push<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>rdi</SPAN><BR>000007fe`f48bfdb5 4154<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">push<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>r12</SPAN><BR>000007fe`f48bfdb7 4155<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">push<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>r13</SPAN><BR>000007fe`f48bfdb9 4156<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">push<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>r14</SPAN><BR>000007fe`f48bfdbb 4883ec70<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">sub<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>rsp,70h</SPAN></B><BR>000007fe`f48bfdbf 48c7442440feffffff mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>qword ptr [rsp+40h],0FFFFFFFFFFFFFFFEh<BR>000007fe`f48bfdc8 48895810<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: darkred; COLOR: white; mso-highlight: darkred">mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>qword ptr [rax+10h],rbx</SPAN></B><BR>000007fe`f48bfdcc 48896818<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: darkred; COLOR: white; mso-highlight: darkred">mov<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>qword ptr [rax+18h],rbp</SPAN></B><o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>The list of operations in the unwind info is listed in the reverse order of the operations in the assembly code.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Each of the UWOP_PUSH_NONVOL operations in the unwind info maps to a nonvolatile register that is pushed onto the stack for safe keeping in the prolog code.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>I have highlighted the sections within the prolog and the .fnent output such that highlighting with like colors indicates related information.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Now, let’s take a look at the raw stack and tie all of this information together.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>Below is the stack with the frame we are focusing on highlighted in yellow:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; kn<BR><SPAN style="mso-spacerun: yes">&nbsp;</SPAN># Child-SP<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>RetAddr<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Call Site<BR>00 00000000`04a51e18 000007fe`fd4e10ac ntdll!NtWaitForSingleObject+0xa<BR>01 00000000`04a51e20 000007fe`f48bffc7 KERNELBASE!WaitForSingleObjectEx+0x79<BR>02 00000000`04a51ec0 000007fe`f48bff70 clr!CLREvent::WaitEx+0x170<BR>03 00000000`04a51f00 000007fe`f48bfe23 clr!CLREvent::WaitEx+0xf8<BR><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">04 </SPAN><SPAN style="BACKGROUND: lime; mso-highlight: lime">00000000`04a51f60 </SPAN><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">000007fe`f48d51d8 clr!CLREvent::WaitEx+0x5e</SPAN><BR>05 00000000`04a52000 000007fe`f4995249 clr!SVR::gc_heap::wait_for_gc_done+0x98<BR>06 00000000`04a52030 000007fe`f48aef28 clr!SVR::GCHeap::Alloc+0xb4<BR>07 00000000`04a520a0 000007fe`f48aecc9 clr!FastAllocatePrimitiveArray+0xc5<BR>08 00000000`04a52120 000007fe`f071244c clr!JIT_NewArr1+0x389<BR>09 00000000`04a522f0 000007fe`f07111b5 System_Numerics_ni+0x2244c<BR>0a 00000000`04a52330 000007ff`00150acf System_Numerics_ni+0x211b5<BR>0b 00000000`04a523d0 000007ff`0015098c 0x7ff`00150acf<BR>0c 00000000`04a52580 000007ff`0015098c 0x7ff`0015098c<BR>0d 00000000`04a52730 000007ff`0015098c 0x7ff`0015098c<BR>0e 00000000`04a528e0 000007ff`0015098c 0x7ff`0015098c<BR>0f 00000000`04a52a90 000007ff`0015098c 0x7ff`0015098c<BR>10 00000000`04a52c40 000007ff`0015098c 0x7ff`0015098c<BR>11 00000000`04a52df0 000007ff`0015098c 0x7ff`0015098c<BR>12 00000000`04a52fa0 000007ff`0015098c 0x7ff`0015098c<BR>13 00000000`04a53150 000007ff`0015098c 0x7ff`0015098c<o:p></o:p></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT size=3><FONT face=Calibri>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>The symbols above look a little weird and may lead you to believe that WaitEx is calling itself recursively, but it is not.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>It only appears that way because you need the private symbols for clr.dll to be able to see the real function name.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Only public symbols are available outside of Microsoft.<o:p></o:p></FONT></FONT></P></DIV>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri></FONT></FONT>&nbsp;</P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>And below is the raw stack relevant to this frame with some highlighting and annotations that I have added:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; dps 00000000`04a51f60-10 L20<BR>00000000`04a51f50<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000001<BR>00000000`04a51f58<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007fe`f48bfe23 clr!CLREvent::WaitEx+0x5e<BR><SPAN style="BACKGROUND: lime; mso-highlight: lime">00000000`04a51f60</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">00000000`c0402388</SPAN></B><BR>00000000`04a51f68<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">00000000`c0402500</SPAN></B><BR>00000000`04a51f70<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">000007fe`f48afaf0</SPAN></B> clr!SystemNative::ArrayCopy<BR>00000000`04a51f78<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">00000000`00000182</SPAN></B><BR>00000000`04a51f80<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">00000000`04a521d0</SPAN></B><BR>00000000`04a51f88<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">000007fe`00000001</SPAN></B><BR>00000000`04a51f90<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">00000000`00000057</SPAN></B><BR>00000000`04a51f98<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">00000000`c0402398</SPAN></B><BR>00000000`04a51fa0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">ffffffff`fffffffe</SPAN></B><BR>00000000`04a51fa8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">007f0000`04a521d0</SPAN></B><BR>00000000`04a51fb0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">fffff880`009ca540</SPAN></B><BR>00000000`04a51fb8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">000007fe`f483da5b</SPAN></B> clr!SVR::heap_select::select_heap+0x1c<BR>00000000`04a51fc0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">fffff880`009ca540</SPAN></B><BR>00000000`04a51fc8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">000007fe`fd4e18aa</SPAN></B> KERNELBASE!ResetEvent+0xa<BR>00000000`04a51fd0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">00000000`0043dc60</SPAN><BR>00000000`04a51fd8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">00000000`00000178</SPAN><BR>00000000`04a51fe0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">00000000`00493c10</SPAN><BR>00000000`04a51fe8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">00000000`0043dc60</SPAN><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></FONT><SPAN style="FONT-FAMILY: Wingdings; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-char-type: symbol; mso-symbol-font-family: Wingdings"><SPAN style="mso-char-type: symbol; mso-symbol-font-family: Wingdings">ß</SPAN></SPAN><FONT face="Courier New"> saved rdi<BR>00000000`04a51ff0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: aqua; mso-highlight: aqua">00000000`00000001</SPAN><BR><BR><SPAN style="mso-spacerun: yes">&nbsp;&nbsp; </SPAN>*** call into clr!CLREvent::WaitEx ***<BR><BR>00000000`04a51ff8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007fe`f48d51d8 clr!SVR::gc_heap::wait_for_gc_done+0x98<BR>00000000`04a52000<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00493ba0<BR>00000000`04a52008<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: darkred; COLOR: white; mso-highlight: darkred">00000000`00493ba0</SPAN></B><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></FONT><SPAN style="FONT-FAMILY: Wingdings; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-char-type: symbol; mso-symbol-font-family: Wingdings"><SPAN style="mso-char-type: symbol; mso-symbol-font-family: Wingdings">ß</SPAN></SPAN><FONT face="Courier New"> saved rbx<BR>00000000`04a52010<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: darkred; COLOR: white; mso-highlight: darkred">00000000`00000058</SPAN></B><SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN></FONT><SPAN style="FONT-FAMILY: Wingdings; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-char-type: symbol; mso-symbol-font-family: Wingdings"><SPAN style="mso-char-type: symbol; mso-symbol-font-family: Wingdings">ß</SPAN></SPAN><FONT face="Courier New"> saved rbp<BR>00000000`04a52018<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007fe`f0711e0f System_Numerics_ni+0x21e0f<BR>00000000`04a52020<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000178<BR>00000000`04a52028<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007fe`f4995249 clr!SVR::GCHeap::Alloc+0xb4<BR>00000000`04a52030<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`0043a140<BR>00000000`04a52038<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`0043dc60<BR>00000000`04a52040<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000000<BR>00000000`04a52048<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`04a522e0<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>In the stack listing I have used the same color highlighting scheme as before to show how the data on the raw stack correlates to the unwind data.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>And, using green highlighting, I have shown how the Child-SP value correlates to the stack frame.<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>The <SPAN style="BACKGROUND: aqua; mso-highlight: aqua">cyan highlighting</SPAN> represents nonvolatile registers that are pushed onto the stack in the prolog code.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The <B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: blue; COLOR: white; mso-highlight: blue">blue highlighting</SPAN></B><SPAN style="COLOR: white"> </SPAN>represents stack space reserved for locals and for register home space allocated for calling sub routines.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In the unwind data the stack reservation is represented by a UWOP_ALLOC_SMALL operation.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>And the <B style="mso-bidi-font-weight: normal"><SPAN style="BACKGROUND: darkred; COLOR: white; mso-highlight: darkred">red highlighting</SPAN></B><SPAN style="COLOR: white"> </SPAN>represents nonvolatile registers that are stored in the home space of the previous stack frame and represented by a UWOP_SAVE_NONVOL operation stored in the unwind information.<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>As you can see, we have all of the information we need in the unwind data to determine which slots on the stack are used for what.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The only thing we don’t know is the partitioning of the reserved stack space for locals, which is described by the private symbol information for the clr.dll module.<o:p></o:p></FONT></FONT></P>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>Tying it all Together<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3 face=Calibri>.fnent produces its output directly from parsing the definition of the </FONT><A href="http://msdn.microsoft.com/en-us/library/ddssxxy8(VS.80).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ddssxxy8(VS.80).aspx"><FONT color=#0000ff size=3 face="Times New Roman">UNWIND_INFO</FONT></A><FONT size=3 face=Calibri> structure and it even gives you the address of where that structure lives in memory.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The UNWIND_INFO structure also contains a variable amount of </FONT><A href="http://msdn.microsoft.com/en-us/library/ck9asaa9.aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ck9asaa9.aspx"><FONT color=#0000ff size=3 face="Times New Roman">UNWIND_CODE</FONT></A><FONT size=3 face=Calibri> structures.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>You can find details of the structure definitions for UNWIND_INFO and UNWIND_CODE </FONT><A href="http://msdn.microsoft.com/en-us/library/ssa62fwe.aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ssa62fwe.aspx"><FONT color=#0000ff size=3 face="Times New Roman">here</FONT></A><FONT size=3><FONT face=Calibri>.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Each parsed line of unwind information in the .fnent output is backed by at least one of these structures.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In fact, you can see the correlation between the structure fields for UNWIND_INFO and the data in the .fnent output as shown below:<o:p></o:p></FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>From UNWIND_CODE:</FONT></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3><FONT face=Calibri>
<TABLE style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; WIDTH: 91.44%; BORDER-COLLAPSE: collapse; BORDER-TOP: medium none; BORDER-RIGHT: medium none; mso-border-alt: solid #BBBBBB .75pt; mso-yfti-tbllook: 160" class=MsoNormalTable border=1 cellSpacing=0 cellPadding=0 width="91%" class="MsoNormalTable">
<TBODY>
<TR style="HEIGHT: 18.55pt; mso-yfti-irow: 0; mso-yfti-firstrow: yes">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.55pt; BORDER-TOP: #bbbbbb 1pt solid; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">UBYTE<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.55pt; BORDER-TOP: #bbbbbb 1pt solid; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">Offset in prolog<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 18.55pt; mso-yfti-irow: 1">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.55pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">UBYTE: 4<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.55pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">Unwind operation code<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 18.55pt; mso-yfti-irow: 2; mso-yfti-lastrow: yes">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.55pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">UBYTE: 4<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.55pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">Operation info<o:p></o:p></SPAN></P></TD></TR></TBODY></TABLE></FONT></FONT></P><FONT face=Calibri>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>From .fnent:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>05: offs b, unwind op 0, op info e<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>The meaning of the OpInfo (operation info) field is dependent on the UnwindOp (unwind operation code) field and is spelled out in the documentation for </FONT><A href="http://msdn.microsoft.com/en-us/library/ck9asaa9.aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ck9asaa9.aspx"><FONT color=#0000ff size=3 face="Times New Roman">UNWIND_CODE</FONT></A><FONT size=3>.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>For example, for the UWOP_PUSH_NONVOL operation shown above, the OpInfo field is an index into the following table, which indicates which nonvolatile register this push is associated with.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Note that the values in the below table are in decimal, while the .fnent values are in hex:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal>
<TABLE style="BORDER-BOTTOM: medium none; BORDER-LEFT: medium none; WIDTH: 84.64%; BORDER-COLLAPSE: collapse; BORDER-TOP: medium none; BORDER-RIGHT: medium none; mso-border-alt: solid #BBBBBB .75pt; mso-yfti-tbllook: 160" class=MsoNormalTable border=1 cellSpacing=0 cellPadding=0 width="84%" class="MsoNormalTable">
<TBODY>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 0; mso-yfti-firstrow: yes">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #bbbbbb 1pt solid; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">0<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #bbbbbb 1pt solid; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RAX<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 1">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">1<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RCX<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 18.35pt; mso-yfti-irow: 2">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.35pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">2<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.35pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RDX<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 3">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">3<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RBX<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 4">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">4<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RSP<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 5">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">5<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RBP<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 6">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">6<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RSI<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 19.1pt; mso-yfti-irow: 7">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">7<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 19.1pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">RDI<o:p></o:p></SPAN></P></TD></TR>
<TR style="HEIGHT: 18.35pt; mso-yfti-irow: 8; mso-yfti-lastrow: yes">
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #bbbbbb 1pt solid; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.35pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">8 to 15<o:p></o:p></SPAN></P></TD>
<TD style="BORDER-BOTTOM: #bbbbbb 1pt solid; BORDER-LEFT: #f0f0f0; PADDING-BOTTOM: 3pt; PADDING-LEFT: 3pt; PADDING-RIGHT: 3pt; BACKGROUND: white; HEIGHT: 18.35pt; BORDER-TOP: #f0f0f0; BORDER-RIGHT: #bbbbbb 1pt solid; PADDING-TOP: 3pt; mso-border-alt: solid #BBBBBB .75pt; mso-border-left-alt: solid #BBBBBB .75pt; mso-border-top-alt: solid #BBBBBB .75pt" vAlign=top>
<P style="LINE-HEIGHT: 140%; MARGIN: 0in 0.75pt 10pt; mso-margin-top-alt: auto; mso-margin-bottom-alt: auto" class=MsoNormal><SPAN style="LINE-HEIGHT: 140%; FONT-FAMILY: 'Segoe UI','sans-serif'; COLOR: black; FONT-SIZE: 10pt">R8 to R15<o:p></o:p></SPAN></P></TD></TR></TBODY></TABLE></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>Therefore, the previous line from the .fnent output represents a push operation for the r14 register (05: offs b, unwind op 0, op info e<SPAN style="mso-tab-count: 1">&nbsp;&nbsp; </SPAN>UWOP_PUSH_NONVOL).<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Looking at the assembly above, we see that the topmost UWOP_PUSH_NONVOL operation in the .fnent output correlates to the last nonvolatile register push in the prolog code (push<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp; </SPAN>r14).<o:p></o:p></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT size=3>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>Remember, the push operations in the .fnent output are listed in the reverse order of where they are in the actual prolog code.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>This helps the unwind code easily calculate offsets of where they should live in the stack.<o:p></o:p></FONT></P></DIV>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3></FONT>&nbsp;</P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>One thing that you will notice in the x64 calling convention is that once the prolog code has executed, the value for rsp will very rarely change.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The Child-SP value in the stack displayed by the </FONT><A href="http://msdn.microsoft.com/en-us/library/ff551943(v=VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ff551943(v=VS.85).aspx"><FONT size=3>k</FONT></A><FONT size=3> commands is the value of rsp for that frame after the prolog code has executed.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>So the offsets to access these nonvolatile registers are then applied to the Child-SP value (previously highlighted in <SPAN style="BACKGROUND: lime; mso-highlight: lime">green</SPAN>) to find where they live on the stack.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>So, in a way, the Child-SP value acts like the base pointer we are used to on the x86 platform.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>In the .fnent output above, you will also see the following:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New"><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00: offs 20, unwind op 4, op info 5<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>UWOP_SAVE_NONVOL FrameOffset: <SPAN style="BACKGROUND: yellow; mso-highlight: yellow">b0</SPAN><o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>For UWOP_SAVE_NONVOL, you see that the .fnent output shows us the offset where we can find this register, and the register in question is represented by the OpInfo value that equates to rbp.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The offset above is applied to the Child-SP value (00000000`04a51f60 in this case) to produce the address 00000000`04a52010, which indicates that’s where we can find a saved copy of rbp.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>I have also annotated where it lives in the raw stack output shown previously.<o:p></o:p></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT size=3>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>If you’re wondering why rbp is stored in the previous stack frame, check out </FONT><A href="http://blogs.msdn.com/ntdebugging/archive/2009/01/09/challenges-of-debugging-optimized-x64-code.aspx" target=_blank mce_href="http://blogs.msdn.com/ntdebugging/archive/2009/01/09/challenges-of-debugging-optimized-x64-code.aspx"><FONT size=3>my previous post on this topic</FONT></A><FONT size=3> where I describe how in optimized builds, the compiler can use the home space from the previous stack frame to save nonvolatile registers thus saving them with a MOV operation as opposed to a PUSH operation.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>This is possible because in optimized builds the home space is not necessarily used to store parameters.<o:p></o:p></FONT></P></DIV>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><o:p><FONT size=3>&nbsp;</FONT></o:p></P>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>So how does all of This Work for CLR JIT Code?<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>If you have asked this question, then you are definitely paying attention!<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>As we have shown, the compiler and linker are responsible for placing unwind info in the Portable Executable file at build time.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>But what about dynamic code that is generated at runtime?<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Certainly there must be unwind information for dynamically compiled code as well, otherwise there would be no way to walk the stack or unwind the stack after an exception. <o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>As it turns out, APIs exist for this very situation, including </FONT><A href="http://msdn.microsoft.com/en-us/library/ms680588(v=VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ms680588(v=VS.85).aspx"><FONT color=#0000ff size=3 face="Times New Roman">RtlAddFunctionTable</FONT></A><FONT size=3><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>and </FONT><A href="http://msdn.microsoft.com/en-us/library/ms680595(VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ms680595(VS.85).aspx"><FONT color=#0000ff size=3 face="Times New Roman">RtlInstallFunctionTableCallback</FONT></A><FONT size=3>.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In fact, the CLR uses RtlInstallFunctionTableCallback.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The generated unwind information is then rooted in a linked list where the head is at ntdll!RtlpDynamicFunctionTable.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>The format of the linked list items is undocumented as it is an implementation detail, but using dbghelp.dll you can find the unwind information for a given instruction pointer if you so desire by calling </FONT><A href="http://msdn.microsoft.com/en-us/library/ms681327(VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ms681327(VS.85).aspx"><FONT color=#0000ff size=3 face="Times New Roman">SymFunctionTableAccess64</FONT></A><FONT size=3>.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>In fact, if you want to see the CLR adding dynamic unwind info in action you can run the test code above under the debugger, and then at the initial breakpoint, before the application starts running, set the following breakpoint:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">bu ntdll!RtlInstallFunctionTableCallback<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>When you let the application run you should then end up with a call stack at the breakpoint that looks like the following, which clearly shows the JIT compiler adding the unwind info to the table dynamically:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:000&gt; kn<BR><SPAN style="mso-spacerun: yes">&nbsp;</SPAN># Child-SP<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>RetAddr<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Call Site<BR>00 00000000`0017dca8 000007fe`f4832cc6 ntdll!RtlInstallFunctionTableCallback<BR>01 00000000`0017dcb0 000007fe`f4831422 clr!InstallEEFunctionTable+0x77<BR>02 00000000`0017df60 000007fe`f4828ca8 clr!StubLinker::EmitUnwindInfo+0x492<BR>03 00000000`0017e050 000007fe`f4832c1a clr!StubLinker::EmitStub+0xe8<BR>04 00000000`0017e0b0 000007fe`f48328e5 clr!StubLinker::LinkInterceptor+0x1ea<BR>05 00000000`0017e160 000007fe`f4831e40 clr!CTPMethodTable::CreateStubForNonVirtualMethod+0xa35<BR>06 00000000`0017e300 000007fe`f4832926 clr!CRemotingServices::GetStubForNonVirtualMethod+0x50<BR>07 00000000`0017e3c0 000007fe`f48223f3 clr!MethodDesc::DoPrestub+0x38b<BR>08 00000000`0017e4d0 000007fe`f47e2d07 clr!PreStubWorker+0x1df<BR>09 00000000`0017e590 000007fe`f48210b4 clr!ThePreStubAMD64+0x87<BR>0a 00000000`0017e660 000007fe`f48211c9 clr!CallDescrWorker+0x84<BR>0b 00000000`0017e6d0 000007fe`f4821245 clr!CallDescrWorkerWithHandler+0xa9<BR>0c 00000000`0017e750 000007fe`f4823cf1 clr!MethodDesc::CallDescr+0x2a1<BR>0d 00000000`0017e9b0 000007fe`f49cdc3d clr!MethodDescCallSite::Call+0x35<BR>0e 00000000`0017e9f0 000007fe`f4999f0d clr!AppDomain::InitializeDomainContext+0x1ac<BR>0f 00000000`0017ebf0 000007fe`f49212a1 clr!SystemDomain::InitializeDefaultDomain+0x13d<BR>10 00000000`0017f0c0 000007fe`f4923dd6 clr!SystemDomain::ExecuteMainMethod+0x191<BR>11 00000000`0017f670 000007fe`f4923cf3 clr!ExecuteEXE+0x43<BR>12 00000000`0017f6d0 000007fe`f49a7365 clr!CorExeMainInternal+0xc4<BR>13 00000000`0017f740 000007fe`f8ad3309 clr!CorExeMain+0x15<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>But there is one more wrinkle to this picture.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>We now know that by using RtlInstallFunctionTableCallback the CLR, or any other JIT engine, can register a callback that provides the unwind information at runtime.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>But how does the debugger access this information?<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>When the debugger is broken into the process or if you are debugging a dump, it cannot execute the callback function registered with RtlInstallFunctionTableCallback.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>This is where the&nbsp;sixth and final parameter to RtlInstallFunctionTableCallback comes into play.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>By providing the OutOfProcessCallbackDll parameter, the CLR is providing a dll which the debugger can use to effectively parse through the JITer’s unwind information statically.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>When inspecting which path the CLR passes for OutOfProcessCallbackDll on my machine, I see the following string:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:000&gt; du /c 80 000007fe`f5916160<BR>000007fe`f5916160<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>"C:\Windows\Microsoft.NET\Framework64\v4.0.30319\<SPAN style="BACKGROUND: yellow; mso-highlight: yellow">mscordacwks.dll</SPAN>"<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>So, the debugger uses mscordacwks.dll to statically examine the unwind info while the process is broken in the debugger or while inspecting a dump.<o:p></o:p></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT size=3>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>This is one of the many reasons why you must have a complete process dump to effectively post-mortem debug managed applications.<o:p></o:p></FONT></P></DIV>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>Using the ‘k =’ Command to Dump the Stack<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>If you look at the documentation for the </FONT><A href="http://msdn.microsoft.com/en-us/library/ff551943(v=VS.85).aspx" target=_blank mce_href="http://msdn.microsoft.com/en-us/library/ff551943(v=VS.85).aspx"><FONT size=3>k</FONT></A><FONT size=3> command, you’ll see that there is a way to override the base pointer when walking the stack.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>However, the documentation leaves it a complete mystery as to how to apply this in the x64 world.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>To demonstrate what I mean, consider the following stack from earlier:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; kn<BR><SPAN style="mso-spacerun: yes">&nbsp;</SPAN># Child-SP<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>RetAddr<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Call Site<BR></FONT><FONT face="Courier New"><SPAN style="BACKGROUND: black; mso-highlight: black">00 00000000`04a51e18 000007fe`fd4e10ac ntdll!NtWaitForSingleObject+0xa<BR>01 00000000`04a51e20 000007fe`f48bffc7 KERNELBASE!WaitForSingleObjectEx+0x79</SPAN><BR>02 00000000`04a51ec0 000007fe`f48bff70 clr!CLREvent::WaitEx+0x170<BR>03 00000000`04a51f00 000007fe`f48bfe23 clr!CLREvent::WaitEx+0xf8<BR>04 00000000`04a51f60 000007fe`f48d51d8 clr!CLREvent::WaitEx+0x5e<BR>05 00000000`04a52000 000007fe`f4995249 clr!SVR::gc_heap::wait_for_gc_done+0x98<BR>06 00000000`04a52030 000007fe`f48aef28 clr!SVR::GCHeap::Alloc+0xb4<BR>07 00000000`04a520a0 000007fe`f48aecc9 clr!FastAllocatePrimitiveArray+0xc5<BR>08 00000000`04a52120 000007fe`f071244c clr!JIT_NewArr1+0x389<BR>09 00000000`04a522f0 000007fe`f07111b5 System_Numerics_ni+0x2244c<BR>0a 00000000`04a52330 000007ff`00150acf System_Numerics_ni+0x211b5<BR>0b 00000000`04a523d0 000007ff`0015098c 0x7ff`00150acf<BR>0c 00000000`04a52580 000007ff`0015098c 0x7ff`0015098c<BR>0d 00000000`04a52730 000007ff`0015098c 0x7ff`0015098c<BR>0e 00000000`04a528e0 000007ff`0015098c 0x7ff`0015098c<BR>0f 00000000`04a52a90 000007ff`0015098c 0x7ff`0015098c<BR>10 00000000`04a52c40 000007ff`0015098c 0x7ff`0015098c<BR>11 00000000`04a52df0 000007ff`0015098c 0x7ff`0015098c<BR>12 00000000`04a52fa0 000007ff`0015098c 0x7ff`0015098c<BR>13 00000000`04a53150 000007ff`0015098c 0x7ff`0015098c<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>Now, imagine the top of the stack is corrupted, which I have “simulated” by blacking out the top few frames in this stack dump.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Furthermore, let’s assume that we identified a frame where the stack starts to look sane again by looking at the raw stack below:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; dps 00000000`04a51e90<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><BR>00000000`04a51e90<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000000<BR>00000000`04a51e98<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`04a52130<BR>00000000`04a51ea0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`ffffffff<BR>00000000`04a51ea8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`ffffffff<BR>00000000`04a51eb0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000108<BR>00000000`04a51eb8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN><SPAN style="BACKGROUND: lime; mso-highlight: lime">000007fe`f48bffc7</SPAN> clr!CLREvent::WaitEx+0x170<BR><SPAN style="BACKGROUND: yellow; mso-highlight: yellow">00000000`04a51ec0</SPAN><SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000000<BR>00000000`04a51ec8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000108<BR>00000000`04a51ed0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007fe`00000000<BR>00000000`04a51ed8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000108<BR>00000000`04a51ee0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>ffffffff`fffffffe<BR>00000000`04a51ee8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000001<BR>00000000`04a51ef0<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000000<BR>00000000`04a51ef8<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>000007fe`f48bff70 clr!CLREvent::WaitEx+0xf8<BR>00000000`04a51f00<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00000000<BR>00000000`04a51f08<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>00000000`00493ba0<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>From looking at this stack, we can see the typical pattern of stack frames because the return addresses resolve to symbols of sorts.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>To dump out the corrupted stack, here is the undocumented syntax for the x64 platform:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">k = &lt;rsp&gt; &lt;rip&gt; &lt;frame_count&gt;<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>&lt;rsp&gt; is the stack pointer to start with.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>You want to use the stack pointer that would have been in rsp when that function was active.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Remember, typically rsp does not change after the function prolog code completes.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Therefore, if you pick the stack pointer just below the return address, you should be good.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>&lt;rip&gt; should be an instruction pointer from within the function that was executing at the time the &lt;rsp&gt; value above was in play.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In this case, the return address directly above &lt;rsp&gt; comes from that function and I have highlighted it in green.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>This piece of information is critical so that the debugger can find the unwind metadata for the function that was current at this point in the stack.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Without it, the debugger cannot walk the stack.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>Armed with this information, you can construct a k command to dump the stack starting from this frame as shown below:<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=12345Trey><FONT face="Courier New">0:012&gt; kn = <SPAN style="BACKGROUND: yellow; mso-highlight: yellow">00000000`04a51ec0</SPAN> <SPAN style="BACKGROUND: lime; mso-highlight: lime">000007fe`f48bffc7</SPAN> 10<BR><SPAN style="mso-spacerun: yes">&nbsp;</SPAN># Child-SP<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>RetAddr<SPAN style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>Call Site<BR>00 00000000`04a51ec0 000007fe`f48bff70 clr!CLREvent::WaitEx+0x170<BR>01 00000000`04a51f00 000007fe`f48bfe23 clr!CLREvent::WaitEx+0xf8<BR>02 00000000`04a51f60 000007fe`f48d51d8 clr!CLREvent::WaitEx+0x5e<BR>03 00000000`04a52000 000007fe`f4995249 clr!SVR::gc_heap::wait_for_gc_done+0x98<BR>04 00000000`04a52030 000007fe`f48aef28 clr!SVR::GCHeap::Alloc+0xb4<BR>05 00000000`04a520a0 000007fe`f48aecc9 clr!FastAllocatePrimitiveArray+0xc5<BR>06 00000000`04a52120 000007fe`f071244c clr!JIT_NewArr1+0x389<BR>07 00000000`04a522f0 000007fe`f07111b5 System_Numerics_ni+0x2244c<BR>08 00000000`04a52330 000007ff`00150acf System_Numerics_ni+0x211b5<BR>09 00000000`04a523d0 000007ff`0015098c 0x7ff`00150acf<BR>0a 00000000`04a52580 000007ff`0015098c 0x7ff`0015098c<BR>0b 00000000`04a52730 000007ff`0015098c 0x7ff`0015098c<BR>0c 00000000`04a528e0 000007ff`0015098c 0x7ff`0015098c<BR>0d 00000000`04a52a90 000007ff`0015098c 0x7ff`0015098c<BR>0e 00000000`04a52c40 000007ff`0015098c 0x7ff`0015098c<BR>0f 00000000`04a52df0 000007ff`0015098c 0x7ff`0015098c<o:p></o:p></FONT></P>
<DIV style="BORDER-BOTTOM: windowtext 1.5pt solid; BORDER-LEFT: medium none; PADDING-BOTTOM: 1pt; PADDING-LEFT: 0in; PADDING-RIGHT: 0in; BORDER-TOP: windowtext 1.5pt solid; BORDER-RIGHT: medium none; PADDING-TOP: 1pt; mso-element: para-border-div">
<P style="MARGIN: 12pt 0in 12pt 0.5in" class=Note><FONT size=3>Note:<SPAN style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp; </SPAN>The frame count in the above k expression is required.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>That is the way the debugger engine distinguishes between this variant of the command (with an overridden rip) and the documented form of k that does not provide an overridden rip.<o:p></o:p></FONT></P></DIV>
<H1 style="MARGIN: 24pt 0in 0pt"><SPAN style="LINE-HEIGHT: 115%; FONT-SIZE: 12pt"><FONT color=#365f91><FONT face=Cambria>Conclusion<o:p></o:p></FONT></FONT></SPAN></H1>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>Since the x64 calling convention does not utilize a base pointer (among other things), we need some extra information to effectively walk the stack.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>That extra information comes in the form of unwind metadata and is generated by the compiler and linker for static code and baked into the portable executable file.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>If you happen to code in assembly language, there are various macros that you must use to decorate your assembly code so that the assembler can generate the proper unwind metadata.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>For dynamically compiled code, that information is instead provided at runtime by registering a callback with the system.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>Knowing this information is critical if you encounter a corrupted stack and must piece it together manually.<SPAN style="mso-spacerun: yes">&nbsp; </SPAN>In such situations you’ll need to know how to dig out the unwind metadata manually and use it to effectively reconstruct the call stack.<o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>That said, you could spare yourself some effort and use the undocumented variant of the k command described above to dump the stack starting at any frame. <SPAN style="FONT-FAMILY: Wingdings; mso-ascii-font-family: Calibri; mso-hansi-font-family: Calibri; mso-char-type: symbol; mso-symbol-font-family: Wingdings"><SPAN style="mso-char-type: symbol; mso-symbol-font-family: Wingdings">J</SPAN></SPAN><o:p></o:p></FONT></P>
<P style="MARGIN: 0in 0in 10pt" class=MsoNormal><FONT size=3>Happy debugging everyone!<o:p></o:p></FONT></P>
<P style="TEXT-JUSTIFY: inter-ideograph; TEXT-ALIGN: justify; LINE-HEIGHT: 10.5pt; MARGIN: 0in 0in 0pt" class=MsoNormal><I><SPAN style="FONT-FAMILY: 'Tahoma','sans-serif'; COLOR: #666666; FONT-SIZE: 9pt">"The example companies, organizations, products, domain names, e-mail addresses, logos, people, places, and events depicted herein are fictitious.&nbsp; No association with any real company, organization, product, domain name, email address, logo, person, places, or events is intended or should be inferred."<o:p></o:p></SPAN></I></P></FONT></div>
    <div class="post-attachment-viewer">
		
    </div>
    <div class="post-actions">
        <div class="navigation-list-header"></div>
        <ul class="navigation-list">
            <!---->
            <li class="navigation-item"><a class="internal-link view-replies" href="/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx#comments"><span></span>0 Comments</a></li>
            
            
        </ul>
        <div class="navigation-list-footer"></div>
    </div>
    <div class="post-tags"><div id="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_Container" style="display: none;"><div class="tags-editor"><textarea id="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_Tags" style="width: 97%; height: 100%;" rows="2" cols="30"></textarea><div style="white-space: nowrap; padding-top: 4px;"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><input type="button" onclick="Telligent_Modal.Open('\/utility\/TagSelector.aspx?TagEditor=ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_TagEditor',400,300,null);;return false;" value="Select Tags..." /></td><td align="right"><input type="button" onclick="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01.Save(); return false;" value="Save" /><input type="button" onclick="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01.Close(); return false;" value="Cancel" /></td></tr></table></div></div></div><span id="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl02"><a href="http://blogs.msdn.com/b/ntdebugging/archive/tags/Trey/" rel="tag">Trey</a>, <a href="http://blogs.msdn.com/b/ntdebugging/archive/tags/x64/" rel="tag">x64</a></span><input type="hidden" name="ctl00$content$ctl00$w_16373$_9be11d$ctl00$ctl15$ctl02" id="ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl02_State" value="nochange" /></div>
</div>
<div class="full-post-footer"></div></div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment social-media-sharing no-wrapper-with-spacing" id="fragment-16374">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">

<link href="/CustomWidgets/SocialMediaSharingUC/resources/sharethis.css" rel="stylesheet" type="text/css" /> 
<script src="/CustomWidgets/SocialMediaSharingUC/resources/ShareThis.js" type="text/javascript"></script>
<div class="ShareThisMainPanel">
	<div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_fefe5c8a_768e_4d5b_9b4b_95095f46c15f" class="ShareThis_ChildRootPanel" onmouseover="ShareThisChildRootPanelOnmouseOver(this.id);" onmouseout="ShareThisChildRootPanelOnmouseOut(this.id);">
		<div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_ShareThisBtnCollPanel_0bf50f5d48a34d339a4095149fa587b4" class="tierOnePanel">
			<div class="buttonPanel">
				<a title="Share on Facebook" class="iconsOnPanel" href="http://www.facebook.com/sharer.php?u=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;t=TITLE_REPLACE" target="_blank"><img title="Share on Facebook" src="/CustomWidgets/SocialMediaSharingUC/Resources/facebook.gif" style="border-width:0px;" /></a>
			</div><div class="buttonPanel">
				<a title="Share on Twitter" class="iconsOnPanel" href="http://twitter.com/home?status=TITLE_REPLACE : http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx" target="_blank"><img title="Share on Twitter" src="/CustomWidgets/SocialMediaSharingUC/Resources/twitter.gif" style="border-width:0px;" /></a>
			</div><div class="buttonPanel">
				<a title="Share on Digg" class="iconsOnPanel" href="http://digg.com/submit?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on Digg" src="/CustomWidgets/SocialMediaSharingUC/Resources/digg.gif" style="border-width:0px;" /></a>
			</div><div class="buttonPanel">
				<a title="Share on del.icio.us" class="iconsOnPanel" href="http://del.icio.us/post?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on del.icio.us" src="/CustomWidgets/SocialMediaSharingUC/Resources/delicious.gif" style="border-width:0px;" /></a>
			</div><div class="buttonPanel">
				<a title="Share on LinkedIn" class="iconsOnPanel" href="http://www.linkedin.com/shareArticle?mini=true&amp;ro=true&amp;url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE&amp;summary=&amp;source=Microsoft&amp;armin=armin" target="_blank"><img title="Share on LinkedIn" src="/CustomWidgets/SocialMediaSharingUC/Resources/linkedin.gif" style="border-width:0px;" /></a>
			</div>
		</div><div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_ShareThisBtnCollPanel_3121062bf1df4da39189aed9aba28700" class="tierTwoPanel" onclick="TierTwoPanelOnclick(this.id);" onkeypress="if (event.keyCode == 13) TierTwoPanelOnclick(this.id);" onmouseover="TierTwoPanelOnmouseOver(this.id);" onmouseout="TierTwoPanelOnmouseOut(this.id);">
			<div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_ShareThisBtnCollPanel_876374cfd3ad4dc9aa3a58c39373b3ad" class="tierTwoRowPanel">
				<div class="buttonPanel">
					<a title="Share on Reddit" class="iconsOnPanel" href="http://www.reddit.com/submit?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on Reddit" src="/CustomWidgets/SocialMediaSharingUC/Resources/reddit.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Slashdot" class="iconsOnPanel" href="http://slashdot.org/bookmark.pl?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on Slashdot" src="/CustomWidgets/SocialMediaSharingUC/Resources/slashdot.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on MySpace" class="iconsOnPanel" href="http://www.myspace.com/Modules/PostTo/Pages/?u=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;t=TITLE_REPLACE" target="_blank"><img title="Share on MySpace" src="/CustomWidgets/SocialMediaSharingUC/Resources/myspace.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Windows Live Spaces" class="iconsOnPanel" href="http://spaces.live.com/BlogIt.aspx?Title=TITLE_REPLACE&amp;SourceURL=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx" target="_blank"><img title="Share on Windows Live Spaces" src="/CustomWidgets/SocialMediaSharingUC/Resources/livefavorites.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Blogmarks" class="iconsOnPanel" href="http://blogmarks.net/my/new.php?mini=1&amp;simple=1&amp;url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE&amp;content=" target="_blank"><img title="Share on Blogmarks" src="/CustomWidgets/SocialMediaSharingUC/Resources/blogmarks.gif" style="border-width:0px;" /></a>
				</div>
			</div><div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_ShareThisBtnCollPanel_f7568324340d4468a07404b12879463c" class="tierTwoRowPanel">
				<div class="buttonPanel">
					<a title="Share on Diigo" class="iconsOnPanel" href="http://www.diigo.com/post?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE&amp;desc=" target="_blank"><img title="Share on Diigo" src="/CustomWidgets/SocialMediaSharingUC/Resources/diigo.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Fark" class="iconsOnPanel" href="http://www.fark.com/cgi/farkit.pl?u=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;h=TITLE_REPLACE" target="_blank"><img title="Share on Fark" src="/CustomWidgets/SocialMediaSharingUC/Resources/fark.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Faves" class="iconsOnPanel" href="http://faves.com/Authoring.aspx?u=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;t=TITLE_REPLACE" target="_blank"><img title="Share on Faves" src="/CustomWidgets/SocialMediaSharingUC/Resources/faves.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Technorati" class="iconsOnPanel" href="http://technorati.com/faves/?add=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx" target="_blank"><img title="Share on Technorati" src="/CustomWidgets/SocialMediaSharingUC/Resources/technorati.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on FriendFeed" class="iconsOnPanel" href="http://friendfeed.com/?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on FriendFeed" src="/CustomWidgets/SocialMediaSharingUC/Resources/friendfeed.gif" style="border-width:0px;" /></a>
				</div>
			</div><div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_ShareThisBtnCollPanel_9970b316abec4eeebb6c63848bc0ae20" class="tierTwoRowPanel">
				<div class="buttonPanel">
					<a title="Share on Windows Live Favorites" class="iconsOnPanel" href="http://favorites.live.com/quickadd.aspx?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on Windows Live Favorites" src="/CustomWidgets/SocialMediaSharingUC/Resources/livefavorites.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Mixx" class="iconsOnPanel" href="http://www.mixx.com/submit?page_url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx" target="_blank"><img title="Share on Mixx" src="/CustomWidgets/SocialMediaSharingUC/Resources/mixx.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Newsvine" class="iconsOnPanel" href="http://www.newsvine.com/_tools/seed&amp;save?u=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;h=TITLE_REPLACE&amp;s=" target="_blank"><img title="Share on Newsvine" src="/CustomWidgets/SocialMediaSharingUC/Resources/newsvine.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on StumbleUpon" class="iconsOnPanel" href="http://www.stumbleupon.com/submit?url=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on StumbleUpon" src="/CustomWidgets/SocialMediaSharingUC/Resources/stumbleupon.gif" style="border-width:0px;" /></a>
				</div><div class="buttonPanel">
					<a title="Share on Google" class="iconsOnPanel" href="http://www.google.com/bookmarks/mark?op=add&amp;bkmk=http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx&amp;title=TITLE_REPLACE" target="_blank"><img title="Share on Google" src="/CustomWidgets/SocialMediaSharingUC/Resources/google.gif" style="border-width:0px;" /></a>
				</div>
			</div>
		</div>
	</div><div id="ctl00_content_ctl00_w_16374__9be11d_ctl00_ShowMoreLessButtonsPanel_b03e3852_1d57_4758_b24a_6d8a2890e189" tabindex="1" class="ShowMoreLessButtonsPanel" onclick="ShowMoreLessButtonsPanelOnClick(this.id);" onkeypress="if (event.keyCode == 13) ShowMoreLessButtonsPanelOnClick(this.id);" onmouseover="ShowMoreLessButtonsPanelOnmouseOver(this.id);" onmouseout="ShowMoreLessButtonsPanelOnmouseOut(this.id);">
		<a class="buttonMoreLess" id="btn_more"><img title="More" src="/CustomWidgets/SocialMediaSharingUC/Resources/more.gif" src="" style="border-width:0px;" /></a><a class="buttonMoreLess" id="btn_less"><img title="Less" src="/CustomWidgets/SocialMediaSharingUC/Resources/less.gif" src="" style="border-width:0px;" /></a>
	</div>
</div><div class="ShareClearFloatsPanel">

</div></div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment captcha-blog-post-comment-form no-wrapper-with-spacing" id="fragment-16375">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">

    
            <div class="field-list-header"></div>
            <fieldset class="field-list">
                <legend class="field-list-description">Leave a Comment</legend>
                <ul class="field-list">
                    <li id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_NameField" class="field-item">
                        <label for="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbName" class="field-item-header">Name</label>
                        <span class="field-item-input"><input name="ctl00$content$ctl00$w_16375$_9be11d$ctl00$ctl00$ctl00$ctl05$bpCommentForm$ctl05$tbName" type="text" size="60" id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbName" /></span>
                        <span id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV" style="color:Red;display:none;"><span class="field-item-validation">*</span></span>
                    </li>
                    <li class="field-item post-body">
                        <label for="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbComment" class="field-item-header">Comment</label>
                        <span class="field-item-input"><textarea name="ctl00$content$ctl00$w_16375$_9be11d$ctl00$ctl00$ctl00$ctl05$bpCommentForm$ctl05$tbComment" rows="2" cols="20" id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbComment" style="height:100px;"></textarea></span>
                        <span id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV" style="color:Red;display:none;"><span class="field-item-validation">* Please enter a comment</span></span>
                    </li>
                    <li class="field-item">
                        
                           <span id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha" style="color:Red;display:none;">*</span><span id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_subtext_captcha">Please add 1 and 7 and type the answer here: <input type="text" name="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_visibleanswer" value="" /></span>


                    </li>
                    <li class="field-item">
                        <span class="field-item-input"><a id="ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_btnSubmit" class="internal-link add-reply" href="javascript:WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;ctl00$content$ctl00$w_16375$_9be11d$ctl00$ctl00$ctl00$ctl05$bpCommentForm$ctl05$btnSubmit&quot;, &quot;&quot;, true, &quot;BlogPostCommentForm-ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00&quot;, &quot;&quot;, false, true))"><span></span>Post</a></span>
                    </li>
                </ul>
            </fieldset>
            <div class="field-list-footer"></div>
        
    
</div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
<div class="content-fragment blog-feedback-list no-wrapper-with-spacing" id="fragment-16376">
<div class="content-fragment-inner wireframe-content-fragment-inner"><div class="content-fragment-top wireframe-content-fragment-top"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div><div class="content-fragment-content">




<script type="text/javascript">
	// <![CDATA[
	$(document).ready(function() {
	$(document).bind('telligent_blogs_commentposted', function(e, message) { 
	            window.setTimeout(new Function(ctl00_content_ctl00_w_16376__9be11d_ctl00_ctl00_DelayedFeedbackList.Reload()), 100); 
	            return true; 
	    });
	    ctl00_content_ctl00_w_16376__9be11d_ctl00_ctl00_DelayedFeedbackList.Reload();
	});
// ]]>
</script>

	

<div id="ctl00_content_ctl00_w_16376__9be11d_ctl00_ctl00_DelayedFeedbackList"><input type="hidden" name="ctl00$content$ctl00$w_16376$_9be11d$ctl00$ctl00$DelayedFeedbackList" value="true:" />
	    
	    
	</div>
</div>
<div class="content-fragment-footer"></div>
<div class="content-fragment-bottom wireframe-content-fragment-bottom"><div class="r1 wireframe-r1"></div><div class="r2 wireframe-r2"></div><div class="r3 wireframe-r3"></div><div class="r4 wireframe-r4"></div></div></div></div>
</div>
</div>
</div>
<div class="layout-footer"></div>
</div></div>

			<div class="footer-fragments-header"></div>
<div class="footer-fragments"><div class="footer-fragment copyright-info" id="footer-fragment-247403536">

<ul class="footer-fragment-links">
    <li class="message copyright">© 2011 Microsoft Corporation.</li>
	<li class="message termsOfService"><a href="http://msdn.microsoft.com/cc300389">Terms of Use</a> </li>
    <li class="message trademarks"><a href="http://www.microsoft.com/library/toolbar/3.0/trademarks/en-us.mspx">Trademarks</a> </li>
    <li class="message privacy"><a href="http://www.microsoft.com/info/privacy.mspx">Privacy Statement</a> </li>
    <li class="message abuse">
    
            <a id="ctl00_footer_fragment_247403536__9be11d_ctl00_ctl00_ctl01_lnkAbuse" href="javascript:WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;ctl00$footer_fragment_247403536$_9be11d$ctl00$ctl00$ctl01$lnkAbuse&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, true))">Report Abuse</a>
        
    </li>
    
</ul></div><div class="footer-fragment omniture-footer-fragment" id="footer-fragment-247403537">


<script type="text/javascript" src="/utility/js/omni_rsid_msdn_current.js"></script>
        <noscript><a href="http://www.omniture.com" title="Web Analytics"><img
        src="http://msstomsdnblogs.112.2O7.net/b/ss/msstomsdnblogs/1/H.20.2--NS/0"
        height="1" width="1" border="0" alt="" /></a></noscript>

</div></div>
<div class="footer-fragments-footer"></div>
		
<script type="text/javascript">
//<![CDATA[
var Page_Validators =  new Array(document.getElementById("ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator"), document.getElementById("ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV"), document.getElementById("ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV"), document.getElementById("ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha"));
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
var ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator = document.all ? document.all["ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator"] : document.getElementById("ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator");
ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator.display = "Dynamic";
ctl00_content_ctl00_w_16368__9be11d_ctl00_ctl01_ctl01_Validator.evaluationfunction = "CustomValidatorEvaluateIsValid";
var ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV = document.all ? document.all["ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV"] : document.getElementById("ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV");
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV.controltovalidate = "ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbName";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV.display = "Dynamic";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV.validationGroup = "BlogPostCommentForm-ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbNameRFV.initialvalue = "";
var ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV = document.all ? document.all["ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV"] : document.getElementById("ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV");
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV.controltovalidate = "ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbComment";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV.display = "Dynamic";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV.validationGroup = "BlogPostCommentForm-ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV.evaluationfunction = "RequiredFieldValidatorEvaluateIsValid";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbCommentRFV.initialvalue = "";
var ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha = document.all ? document.all["ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha"] : document.getElementById("ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha");
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha.errormessage = "*";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha.display = "Dynamic";
ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha.validationGroup = "BlogPostCommentForm-ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00";
//]]>
</script>

<script type="text/javascript">
// <![CDATA[
ctl00_content_ctl00 = new ContentFragmentPageCustomCallback('ctl00_content_ctl00',new Function('mode','parameters','callback','errorCallback','context','ctl00_content_ctl00_ctl00._doCallback(mode+\':\'+parameters,callback,context,errorCallback);'));
// ]]>
</script>
<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
rdf:about="http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx"
dc:identifier="http://blogs.msdn.com/b/ntdebugging/archive/2010/05/12/x64-manual-stack-reconstruction-and-stack-walking.aspx"
dc:title="x64 Manual Stack Reconstruction and Stack Walking"
trackback:ping="http://blogs.msdn.com/b/ntdebugging/trackback.ashx?WeblogPostID=10011295" />
</rdf:RDF>
-->
<script type="text/javascript">
// <![CDATA[
Telligent_Modal.Configure('\/utility\/loading.htm',['modal'],['modal-title','modal-title-2','modal-title-3','modal-title-4'],['modal-close'],['modal-content','modal-content-2'],['modal-footer','modal-footer-2','modal-footer-3'],['modal-resize'],['modal-mask'],10000,false,true,true);
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_header_fragment_247403540__9be11d_ctl00_SearchPopup = new Telligent_PopupPanel('ctl00_header_fragment_247403540__9be11d_ctl00_SearchPopup','menu search-content results','downright',100,null,null,true,'ctl00_header_fragment_247403540__9be11d_ctl00_SearchPopup',null,null);
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup = new Telligent_PopupPanel('ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup','menu group-navigation-content','down',100,null,null,false,'ctl00_header_fragment_247403541__9be11d_ctl00_ctl00_GroupNavigationPopup',new Function('Core_GroupNavigation_MouseOverPopup(ctl00_header_fragment_247403541)'),new Function('Core_GroupNavigation_MouseOutPopup(ctl00_header_fragment_247403541)'));
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_content_ctl00_ctl00 = new Telligent_CallbackManager('ctl00_content_ctl00_ctl00','ctl00$content$ctl00$ctl00','aspnetForm');
// ]]>
</script>
<script type="text/javascript">
//<![CDATA[

var Page_ValidationActive = false;
if (typeof(ValidatorOnLoad) == "function") {
    ValidatorOnLoad();
}

function ValidatorOnSubmit() {
    if (Page_ValidationActive) {
        return ValidatorCommonOnSubmit();
    }
    else {
        return true;
    }
}
        //]]>
</script>
<script type="text/javascript">
// <![CDATA[
var ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01=new RateableContentRating('ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01_Value', 5, '/Utility/images/', false, 'rating','rating active','rating readonly',['Terrible','Poor','Fair','Average','Good','Excellent'],true,true);
// ]]>
</script>
<script type="text/javascript">
//<![CDATA[

WebForm_InitCallback();//]]>
</script>
<script type="text/javascript">
				// <![CDATA[
				var ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl01_ajax={"SaveRating":function(rating,successFunction,failureFunction){WebForm_DoCallback('ctl00$content$ctl00$w_16373$_9be11d$ctl00$ctl01',rating,successFunction,rating,failureFunction,true)}};
				// ]]>
				</script><script type="text/javascript">
// <![CDATA[
window.ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01 = new Telligent_InlineEditor('ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_Container',new Function('id', 'p', 'ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor.SetInlineEditorPanelAndParameter(id,p);'),new Function('return ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor.GetContent();'),new Function('c', 'ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor.SetContent(c);'),null,new Function('ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor.Focus();'),new Function('w', 'h', 'ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor.Resize(w,h);'),300,90);
// ]]>
</script><script type="text/javascript">
// <![CDATA[
var ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_TagEditor = new TagEditor('ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_TagEditor',[['Aman','Aman'],['Anurag','Anurag'],['Architecture','Architecture'],['assembler','assembler'],['Bob','Bob'],['boot','boot'],['Bryan','Bryan'],['bugcheck','bugcheck'],['Burrough','Burrough'],['Chad','Chad'],['chat','chat'],['Cluster','Cluster'],['consumption','consumption'],['David','David'],['Deadlock','Deadlock'],['debug','debug'],['Debug Ninja','Debug Ninja'],['Debug Tips','Debug Tips'],['Debugging','Debugging'],['Dennis','Dennis'],['Disk','Disk'],['East','East'],['ETW','ETW'],['Fundamentals Exercise','Fundamentals Exercise'],['GEC','GEC'],['GEC 2009','GEC 2009'],['Graham','Graham'],['gui','gui'],['handles','handles'],['Hangs','Hangs'],['hardware','hardware'],['Heap','Heap'],['i\/o','i\/o'],['internals','internals'],['IPP','IPP'],['Ivan','Ivan'],['Jason','Jason'],['Jeff','Jeff'],['joel','joel'],['John','John'],['kernel','kernel'],['kernrate','kernrate'],['leak','leak'],['Links','Links'],['Louis','Louis'],['lpc','lpc'],['Managed','Managed'],['Mark','Mark'],['Matt','Matt'],['Matthew','Matthew'],['Mike','Mike'],['naresh','naresh'],['NDIS','NDIS'],['Netmon','Netmon'],['Nischay','Nischay'],['NTFS','NTFS'],['ODbgExt','ODbgExt'],['Omer','Omer'],['Pages','Pages'],['Parser','Parser'],['Pool','Pool'],['PTE','PTE'],['Pushkar','Pushkar'],['Puzzler','Puzzler'],['Queue','Queue'],['Remote Debugging','Remote Debugging'],['Rob','Rob'],['Robot','Robot'],['Ron','Ron'],['roy','roy'],['ryan','ryan'],['Ryanman','Ryanman'],['Sabin','Sabin'],['Scoping','Scoping'],['Scott','Scott'],['SCSI','SCSI'],['services','services'],['shutdown','shutdown'],['Somak','Somak'],['startup','startup'],['Steve','Steve'],['storport','storport'],['svchost','svchost'],['Talkback','Talkback'],['Tate','Tate'],['Tate Xperf','Tate Xperf'],['timeout','timeout'],['Todd','Todd'],['Tools','Tools'],['Trey','Trey'],['UMDH','UMDH'],['utilities','utilities'],['Venkatesh','Venkatesh'],['video','video'],['windbg','windbg'],['windows','windows'],['windows internals','windows internals'],['WMI','WMI'],['x64','x64'],['XPERF','XPERF']],'ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_Tags');
// ]]>
</script><script type="text/javascript">
// <![CDATA[
var ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor = new InlineTagEditor('ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_InlineTagEditor','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_Container','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01_Tags');
// ]]>
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl02 = new Telligent_InlineEditorPanel('ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl02','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl02','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl02_State','ctl00_content_ctl00_w_16373__9be11d_ctl00_ctl15_ctl01',false,null,null,null);
// ]]>
</script>
<script type="text/javascript">
//<![CDATA[
$('#ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_tbComment').autoResize({animate : false,extraSpace : 0,limit : 3000});//]]>
</script>
<script type="text/javascript">
subtext_invisible_captcha_hideFromJavascriptEnabledBrowsers('ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_subtext_captcha');
</script><script type="text/javascript">
subtext_invisible_captcha_setAnswer(1, 7, 'ctl00_content_ctl00_w_16375__9be11d_ctl00_ctl00_ctl00_ctl05_bpCommentForm_ctl05_invisibleCaptcha_answer');
</script><script type="text/javascript">
// <![CDATA[
window.ctl00_content_ctl00_w_16376__9be11d_ctl00_ctl00_DelayedFeedbackList = new DelayedContent('ctl00_content_ctl00_w_16376__9be11d_ctl00_ctl00_DelayedFeedbackList','ctl00_content_ctl00_w_16376__9be11d_ctl00_ctl00_DelayedFeedbackList','ctl00_content_ctl00._customCallback(\'fragment-16376\',\'ctl00$content$ctl00$w_16376$_9be11d$ctl00$ctl00$DelayedFeedbackList\',argument,null,callback,null)',true,true,null);
// ]]>
</script></form>
      
    <script type="text/javascript">
        $(window).load(function () {
            $.getScript('http://widgets.membership.microsoft.com/v1/loader.js?brand=technet&lang=en-US', function () {
            });
        });
    </script>
    
	</body>
</html>
