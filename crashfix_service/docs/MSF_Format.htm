
 



 
 
 



 
 
 <!DOCTYPE html>
<html>
<head>
 <link rel="icon" type="image/vnd.microsoft.icon" href="http://www.gstatic.com/codesite/ph/images/phosting.ico">
 
 
 <link rel="canonical" href="http://code.google.com/p/pdbparser/wiki/MSF_Format" />
 
 <script type="text/javascript">
 
 
 
 
 var codesite_token = null;
 
 
 var CS_env = {"token":null,"assetHostPath":"http://www.gstatic.com/codesite/ph","domainName":null,"assetVersionPath":"http://www.gstatic.com/codesite/ph/18339216115563546213","projectName":"pdbparser","projectHomeUrl":"/p/pdbparser","absoluteBaseUrl":"http://code.google.com","relativeBaseUrl":"","urlPrefix":"p","loggedInUserEmail":null};
 </script>
 
 
 <title>MSF_Format - 
 pdbparser -
 
 File layout and format description of Multi-Stream Files (MSF; enclosing format for PDB debug symbols) - 
 Parsing library for PDB file format (debugging information) - Google Project Hosting
 </title>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/18339216115563546213/css/ph_core.css">
 
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/18339216115563546213/css/ph_detail.css" >
 
 
 
 <link type="application/atom+xml" rel="alternate" href="/feeds/p/pdbparser/svnchanges/basic?path=/wiki/MSF_Format.wiki">
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/18339216115563546213/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 
 
 #maincol {
 padding-top: 0;
 padding-bottom: 0;
 }

 </style>
</head>
<body class="t6">
 <script type="text/javascript">
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 </script>
<div class="headbg">
 <div id="gaia">
 

 <span>
 
 <a href="#" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>&#9660;</small></a>
 | <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fpdbparser%2Fwiki%2FMSF_Format&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fpdbparser%2Fwiki%2FMSF_Format" onclick="_CS_click('/gb/ph/signin');"><u>Sign in</u></a>
 
 </span>

 </div>
 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px"></div>
<!--[if lte IE 7]>
<div style="text-align:center;">
Your version of Internet Explorer is not supported. Try a browser that
contributes to open source, such as <a href="http://www.firefox.com">Firefox</a>,
<a href="http://www.google.com/chrome">Google Chrome</a>, or
<a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>.
</div>
<![endif]-->




 <table style="padding:0px; margin: 0px 0px 10px 0px; width:100%" cellpadding="0" cellspacing="0">
 <tr style="height: 58px;">
 
 <td id="plogo">
 <a href="/p/pdbparser/">
 
 <img src="http://www.gstatic.com/codesite/ph/images/defaultlogo.png" alt="Logo">
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em">
 
 <div id="pname">
 <a href="/p/pdbparser/">pdbparser</a>
 </div>
 
 <div id="psum">
 <a id="project_summary_link" href="/p/pdbparser/" >Parsing library for PDB file format (debugging information)</a>
 
 </div>
 
 
 </td>
 <td style="white-space:nowrap;text-align:right; vertical-align:bottom;">
 
 <form action="/hosting/search">
 <input size="30" name="q" value="" type="text">
 <input type="submit" name="projectsearch" value="Search projects" >
 </form>
 
 </tr>
 </table>

</div>

 
<div id="mt" class="gtb"> 
 <a href="/p/pdbparser/" class="tab ">Project&nbsp;Home</a>
 
 
 
 
 <a href="/p/pdbparser/downloads/list" class="tab ">Downloads</a>
 
 
 
 
 
 <a href="/p/pdbparser/w/list" class="tab active">Wiki</a>
 
 
 
 
 
 <a href="/p/pdbparser/issues/list"
 class="tab ">Issues</a>
 
 
 
 
 
 <a href="/p/pdbparser/source/checkout"
 class="tab ">Source</a>
 
 
 
 
 
 <div class=gtbc></div>
</div>
<table cellspacing="0" cellpadding="0" width="100%" align="center" border="0" class="st">
 <tr>
 
 
 
 <td class="subt">
 <div class="issueDetail">
<div class="isf">
 
 <span class="inIssueList"> 
 <span>Search</span>
 <form action="/p/pdbparser/w/list" method="GET" style="display:inline">
 <select id="can" name="can" >
 <option disabled="disabled">Search within:</option>
 
 <option value="1" >&nbsp;All wiki pages</option>
 <option value="3" >&nbsp;Featured pages</option>
 <option value="2" selected="selected">&nbsp;Current pages</option>
 
 
 <option value="4" >&nbsp;Deprecated pages</option>
 
 </select>
 <span>for</span>
 <span id="qq"><input type="text" size="38" id="searchq" name="q" value=""
 autocomplete="off" ></span>
 
 
 <input type="submit" value="Search" >
 </form>
 </span>

 
 
 
 
 
 
 

</div>
</div>

 </td>
 
 
 
 
 
 
 <td align="right" valign="top" class="bevel-right"></td>
 </tr>
</table>


<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>
<div id="maincol"
 
>

 
<!-- IE -->







 <style type="text/css">
 .delcom { background: #e8e8e8 }
 .commentcontent {
 margin: 2em;
 padding: 0px 10px;
 width: 66em;
 }
 .artifactcomment {
 border-top: 3px solid #c3d9ff;
 }
 #commentform {
 border-top: 3px solid #c3d9ff;
 }
 </style>

<div id="wikipage">
<table>
 <tr>
 
 
 <td style="vertical-align:top; padding-left:5px">
 
 <div id="wikiheader">
 
 <span style="font-size:120%;font-weight:bold">MSF_Format</span>
 &nbsp;
 <div> 
 
 <i>File layout and format description of Multi-Stream Files (MSF; enclosing format for PDB debug symbols)</i>
 
 
 <br/>
 
 <a class="label" style="padding-top: 2px"
 href="/p/pdbparser/w/list?q=label:Phase-Implementation"
 title="Developers&#39; guide"
 >Phase-Implementation</a>, 
 
 <a class="label" style="padding-top: 2px"
 href="/p/pdbparser/w/list?q=label:Phase-Design"
 title="Project design and key concerns"
 >Phase-Design</a>, 
 
 <a class="label" style="padding-top: 2px"
 href="/p/pdbparser/w/list?q=label:File-Format"
 title=""
 >File-Format</a>
 
 
 
 <div id="wikiauthor" style="float:right">
 Updated <span title="Fri Jul  9 07:28:10 2010">
 Jul 9, 2010</span>
 
 by <a style="white-space: nowrap" href="/u/xgreatx/">xgreatx</a>
 
 </div>
 </div>
 </div>
 
 <div id="wikicontent">
 <div class="vt" id="wikimaincol">
 <h1><a name="Main_principles"></a>Main principles<a href="#Main_principles" class="section_anchor"></a></h1><p>MSF file consists of a set of streams. Each stream has the following properties: <ul><li>ID (integer, 0-based. for example, Stream #1 always contains PDB headers) </li><li>Content (data pointer + length (<tt>= NumberOfPages * MSF-&gt;PageSize</tt>)) </li><li>Array of page numbers </li><li>Number of pages </li></ul></p><h1><a name="MSF_header"></a>MSF header<a href="#MSF_header" class="section_anchor"></a></h1><p>MSF header (see MSF_HDR in symeng\msf.cpp) has the following layout: <table class="wikitable"><tr><td style="border: 1px solid #ccc; padding: 5px;"> <strong>Offset</strong> </td><td style="border: 1px solid #ccc; padding: 5px;"> <strong>Size</strong> </td><td style="border: 1px solid #ccc; padding: 5px;"> <strong>Comment</strong> </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x00 (0) </td><td style="border: 1px solid #ccc; padding: 5px;"> 32 </td><td style="border: 1px solid #ccc; padding: 5px;"> Signature <tt>#define MSF_SIGNATURE_700 &quot;Microsoft C/C++ MSF 7.00\r\n\032DS\0\0&quot;</tt> </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x20 (32) </td><td style="border: 1px solid #ccc; padding: 5px;"> DWORD </td><td style="border: 1px solid #ccc; padding: 5px;"> <tt>PageSize</tt>, in bytes. File size is always a multiple of page size </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x24 (36) </td><td style="border: 1px solid #ccc; padding: 5px;"> DWORD </td><td style="border: 1px solid #ccc; padding: 5px;"> FPM Page# (Free Page Map). Destiny: unknown (field ignored) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x28 (40) </td><td style="border: 1px solid #ccc; padding: 5px;"> DWORD </td><td style="border: 1px solid #ccc; padding: 5px;"> Page Count. File size always equals <tt>PageSize*PageCount</tt> </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x2c (44) </td><td style="border: 1px solid #ccc; padding: 5px;"> DWORD </td><td style="border: 1px solid #ccc; padding: 5px;"> Root directory size, in bytes </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x30 (48) </td><td style="border: 1px solid #ccc; padding: 5px;"> DWORD </td><td style="border: 1px solid #ccc; padding: 5px;"> reserved (not used, ignored) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0x34 (52) </td><td style="border: 1px solid #ccc; padding: 5px;"> array of 0x49 (73) DWORD&#x27;s </td><td style="border: 1px solid #ccc; padding: 5px;"> Root directory pointers (page numbers containing root directory) </td></tr> </table></p><p>Total length: 0x158 (344) bytes. </p><h1><a name="Maximum_size_of_MSF_container"></a>Maximum size of MSF container<a href="#Maximum_size_of_MSF_container" class="section_anchor"></a></h1><p>Hardware restrictions on maximum container size are almost absent. Maximum number of pages for root directory, as we can see, is 0x49. Root directory can hold lots of streams with big content length. Also, page size can be as big as we wish (and 32 bits can hold). In practice, the particular implementation of PDB library can add its own restrictions on maximum page size, peak page count or maximum container length, etc.. So, MSF containers can hold lots of data. </p><h1><a name="Root_directory"></a>Root directory<a href="#Root_directory" class="section_anchor"></a></h1><p>Root directory contains array of stream descriptors. Root directory is followed by free page map (complete layout is unknown, ignored). First DWORD of root directory is the number of streams. Number of streams is followed by array of stream sizes (in pages; number of elements == stream count). Stream size array is followed by array of stream pointers (list of page numbers of pages occupied by the stream). Number of pages in stream pointers == stream page count. Number of streams in outer array == stream count. </p><h1><a name="Stream_types"></a>Stream types<a href="#Stream_types" class="section_anchor"></a></h1><p><table class="wikitable"><tr><td style="border: 1px solid #ccc; padding: 5px;"> <strong>Stream#</strong>   </td><td style="border: 1px solid #ccc; padding: 5px;"> <strong>Description</strong> </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 0         </td><td style="border: 1px solid #ccc; padding: 5px;"> Root directory (copy) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 1         </td><td style="border: 1px solid #ccc; padding: 5px;"> PDB headers (see <a href="/p/pdbparser/wiki/PDBHeadersFormat">PDBHeadersFormat</a>) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 2         </td><td style="border: 1px solid #ccc; padding: 5px;"> TPI (type info) (see TPIFormat) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 3         </td><td style="border: 1px solid #ccc; padding: 5px;"> DBI (debug info) (see DBIHeaderFormat) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> 5         </td><td style="border: 1px solid #ccc; padding: 5px;"> FPO (frame pointers omission info) (see FPOEntriesFormat) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> variable  </td><td style="border: 1px solid #ccc; padding: 5px;"> GSI (global symbol information) (see GSIPSIFormat) </td></tr> <tr><td style="border: 1px solid #ccc; padding: 5px;"> variable  </td><td style="border: 1px solid #ccc; padding: 5px;"> PSI (private symbol information) (see GSIPSIFormat) </td></tr> </table></p><h1><a name="Misc"></a>Misc<a href="#Misc" class="section_anchor"></a></h1><p>Calculate number of pages spanned by size-length bytes: <tt>#define STREAM_SPAN_PAGES(msf,size) (ALIGN_UP(size,msf-&gt;hdr-&gt;dwPageSize)/msf-&gt;hdr-&gt;dwPageSize)</tt> Other pages of the MSF contains stream data (type depends on a stream). </p>
 </div>
 </div>
 </td><tr>
</table>
 </div>


 
 
 
 
 <br>
 <div class="artifactcomment">
 <span class="indicator">&#9658;</span> <a href="https://www.google.com/accounts/ServiceLogin?service=code&amp;ltmpl=phosting&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fpdbparser%2Fwiki%2FMSF_Format&amp;followup=http%3A%2F%2Fcode.google.com%2Fp%2Fpdbparser%2Fwiki%2FMSF_Format"
 >Sign in</a> to add a comment
 </div>
 
 
 
 
 <form name="delcom" action="../w/delComment.do" method="POST">
 <input type="hidden" name="sequence_num" value="" >
 <input type="hidden" name="create_time" value="" >
 <input type="hidden" name="mode" value="" >
 <input type="hidden" name="pagename" value="MSF_Format" >
 <input type="hidden" name="token" value="" >
 </form>



 <script src="http://www.gstatic.com/codesite/ph/18339216115563546213/js/prettify/prettify.js"></script>
 <script type="text/javascript">
 prettyPrint();
 </script>

<script type="text/javascript" src="http://www.gstatic.com/codesite/ph/18339216115563546213/js/dit_scripts.js"></script>


<script type="text/javascript" src="https://apis.google.com/js/plusone.js">
</script>

  
 
 
 <script type="text/javascript" src="http://www.gstatic.com/codesite/ph/18339216115563546213/js/ph_core.js"></script>
 
 
 
 
 <script type="text/javascript" src="/js/codesite_product_dictionary_ph.pack.04102009.js"></script>
</div> 
<div id="footer" dir="ltr">
 <div class="text">
 &copy;2011 Google -
 <a href="/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="/p/support/">Project Hosting Help</a>
 </div>
</div>
 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>
 
 


 
 </body>
</html>


